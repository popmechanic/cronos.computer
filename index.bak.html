<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>cronos.computer</title>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
      :root {
        /* Core colors */
        --vibes-black: #0f172a;
        --vibes-white: #ffffff;
        --vibes-near-black: #1a1a1a;
        --vibes-cream: #fffff0;

        /* Gray scale */
        --vibes-gray-lightest: #f1f5f9;
        --vibes-gray-ultralight: #f8fafc;

        /* Menu colors */
        --vibes-menu-bg: #CCCDC8;
        --vibes-menu-grid: rgba(255, 255, 255, 0.5);

        /* Button variant colors */
        --vibes-variant-blue: #009ACE;
        --vibes-variant-red: #DA291C;
        --vibes-variant-yellow: #DA291C;
        --vibes-variant-gray: #6b7280;

        /* Button styling */
        --vibes-button-bg: var(--vibes-cream);
        --vibes-button-text: var(--vibes-near-black);
        --vibes-button-border: var(--vibes-near-black);
        --vibes-button-icon-bg: #fff;
        --vibes-button-icon-fill: #2a2a2a;

        /* Landing page theming - cronos.computer periwinkle palette */
        --landing-accent: oklch(47% 0.118 222);
        --landing-accent-hover: oklch(57% 0.133 232);

        /* Admin dashboard theming - cronos.computer periwinkle palette */
        --admin-bg: oklch(99% 0.089 282);
        --admin-card-bg: white;
        --admin-text: oklch(47% 0.118 222);
        --admin-text-muted: oklch(57% 0.133 232);
        --admin-accent: oklch(67% 0.164 252);
        --admin-border: oklch(82% 0.125 242);
        --admin-shadow: oklch(47% 0.118 222);
      }
      body {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      }
      #container {
        width: 100%;
        min-height: 100vh;
      }

      /* === cronos.computer Landing Page Styles === */
      @import url('https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,300..900;1,9..144,300..900&display=swap');

      :root {
        /* Periwinkle OKLCH Palette */
        --ana-1: oklch(67% 0.164 252);
        --ana-2: oklch(47% 0.118 222);
        --ana-3: oklch(57% 0.133 232);
        --ana-4: oklch(82% 0.125 242);
        --ana-5: oklch(92% 0.103 267);
        --ana-6: oklch(99% 0.089 282);
        --bg-primary: oklch(99% 0.02 270);
        --bg-dark: oklch(15% 0.08 252);
        --text-primary: oklch(20% 0.05 252);
        --text-secondary: oklch(45% 0.08 252);
        --text-muted: oklch(55% 0.06 252);
      }

      .landing-page {
        font-family: 'Fraunces', Georgia, serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        line-height: 1.7;
        -webkit-font-smoothing: antialiased;
      }

      .landing-page h1, .landing-page h2, .landing-page h3 {
        font-family: 'Fraunces', Georgia, serif;
        font-weight: 400;
        line-height: 1.15;
        letter-spacing: -0.02em;
      }

      /* Navigation */
      .landing-nav {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        padding: 1rem 0;
        background: linear-gradient(180deg, var(--bg-primary) 0%, transparent 100%);
        transition: background 0.4s ease;
      }

      .landing-nav.scrolled {
        background: oklch(99% 0.02 270 / 0.95);
        backdrop-filter: blur(20px);
      }

      .landing-logo {
        font-family: 'Fraunces', Georgia, serif;
        font-size: 1.5rem;
        font-weight: 500;
        font-style: italic;
        color: var(--ana-2);
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      /* Buttons */
      .landing-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.75rem;
        padding: 1rem 2rem;
        font-family: 'Fraunces', Georgia, serif;
        font-size: 1rem;
        font-weight: 500;
        text-decoration: none;
        border: none;
        border-radius: 100px;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      }

      .landing-btn-primary {
        background: var(--ana-2);
        color: #fff;
        box-shadow: 0 4px 24px oklch(47% 0.118 222 / 0.3);
      }

      .landing-btn-primary:hover {
        background: var(--ana-3);
        transform: translateY(-2px);
        box-shadow: 0 8px 32px oklch(47% 0.118 222 / 0.4);
      }

      .landing-btn-secondary {
        background: transparent;
        color: var(--ana-2);
        border: 1.5px solid var(--ana-2);
      }

      .landing-btn-secondary:hover {
        background: var(--ana-2);
        color: var(--ana-6);
      }

      .landing-btn-large {
        padding: 1.25rem 3rem;
        font-size: 1.125rem;
      }

      /* Hero */
      .landing-hero {
        min-height: 100vh;
        display: flex;
        align-items: center;
        position: relative;
        overflow: hidden;
        padding: 8rem 0;
      }

      .landing-hero-gradient {
        position: absolute;
        inset: 0;
        background:
          radial-gradient(ellipse 80% 60% at 50% 0%, oklch(92% 0.103 267 / 0.5) 0%, transparent 70%),
          radial-gradient(ellipse 60% 50% at 80% 20%, oklch(82% 0.125 242 / 0.3) 0%, transparent 60%),
          radial-gradient(ellipse 50% 40% at 20% 80%, oklch(67% 0.164 252 / 0.15) 0%, transparent 50%);
        z-index: -1;
      }

      .landing-orb {
        position: absolute;
        border-radius: 50%;
        filter: blur(1px);
        animation: landing-float 20s ease-in-out infinite;
        z-index: -1;
      }

      .landing-orb-1 {
        width: 400px;
        height: 400px;
        top: 10%;
        right: -100px;
        background: radial-gradient(circle at 30% 30%, oklch(82% 0.125 242 / 0.4), oklch(67% 0.164 252 / 0.1));
      }

      .landing-orb-2 {
        width: 250px;
        height: 250px;
        top: 60%;
        left: 5%;
        background: radial-gradient(circle at 60% 40%, oklch(92% 0.103 267 / 0.5), oklch(82% 0.125 242 / 0.1));
        animation-delay: -7s;
      }

      .landing-orb-3 {
        width: 150px;
        height: 150px;
        top: 30%;
        left: 30%;
        background: radial-gradient(circle at 50% 50%, oklch(67% 0.164 252 / 0.3), transparent);
        animation-delay: -14s;
      }

      @keyframes landing-float {
        0%, 100% { transform: translate(0, 0) rotate(0deg); }
        25% { transform: translate(20px, -30px) rotate(5deg); }
        50% { transform: translate(-10px, 20px) rotate(-3deg); }
        75% { transform: translate(15px, 10px) rotate(2deg); }
      }

      .landing-star {
        position: absolute;
        width: 2px;
        height: 2px;
        background: var(--ana-2);
        border-radius: 50%;
        opacity: 0.4;
        animation: landing-twinkle 3s ease-in-out infinite;
      }

      @keyframes landing-twinkle {
        0%, 100% { opacity: 0.2; transform: scale(1); }
        50% { opacity: 0.6; transform: scale(1.3); }
      }

      .landing-eyebrow {
        font-size: 0.85rem;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        color: var(--ana-2);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 1rem;
      }

      .landing-eyebrow::before, .landing-eyebrow::after {
        content: 'âœ¦';
        font-size: 0.7rem;
      }

      /* Subdomain input */
      .subdomain-wrapper {
        display: flex;
        align-items: center;
        background: #fff;
        border: 2px solid var(--ana-4);
        border-radius: 100px;
        padding: 0.5rem 1.5rem;
        box-shadow: 0 4px 24px oklch(47% 0.118 222 / 0.1);
        transition: all 0.3s ease;
      }

      .subdomain-wrapper:focus-within {
        border-color: var(--ana-1);
        box-shadow: 0 8px 32px oklch(47% 0.118 222 / 0.2);
      }

      .subdomain-wrapper input {
        border: none;
        outline: none;
        font-family: 'Fraunces', Georgia, serif;
        font-size: 1.25rem;
        font-weight: 500;
        color: var(--ana-2);
        width: 140px;
        text-align: right;
        background: transparent;
      }

      .subdomain-wrapper input::placeholder {
        color: var(--ana-4);
      }

      .subdomain-suffix {
        font-family: 'Fraunces', Georgia, serif;
        font-size: 1.25rem;
        font-weight: 400;
        color: var(--text-muted);
        white-space: nowrap;
      }

      /* Feature cards */
      .landing-feature-card {
        padding: 4rem;
        background: linear-gradient(135deg, oklch(99% 0.02 270), oklch(96% 0.04 267));
        border: 1px solid oklch(90% 0.06 267);
        border-radius: 24px;
        transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        position: relative;
        overflow: hidden;
      }

      .landing-feature-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--ana-1), var(--ana-4));
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 0.4s ease;
      }

      .landing-feature-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 60px oklch(47% 0.118 222 / 0.12);
      }

      .landing-feature-card:hover::before {
        transform: scaleX(1);
      }

      .landing-feature-icon {
        width: 64px;
        height: 64px;
        border-radius: 16px;
        background: linear-gradient(135deg, var(--ana-5), var(--ana-4));
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.75rem;
        margin-bottom: 2rem;
      }

      /* Steps */
      .landing-step-number {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background: var(--bg-primary);
        border: 2px solid var(--ana-4);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 2rem;
        font-family: 'Fraunces', Georgia, serif;
        font-size: 3rem;
        font-weight: 300;
        color: var(--ana-1);
      }

      /* Testimonials */
      .landing-testimonial-card {
        padding: 4rem;
        background: oklch(20% 0.05 252 / 0.5);
        backdrop-filter: blur(20px);
        border: 1px solid oklch(40% 0.08 252 / 0.3);
        border-radius: 24px;
      }

      .landing-testimonial-stars {
        color: oklch(80% 0.15 80);
        font-size: 1.25rem;
        margin-bottom: 1rem;
        letter-spacing: 0.1em;
      }

      /* Pricing */
      .landing-pricing-card {
        padding: 4rem;
        background: var(--bg-primary);
        border: 1.5px solid oklch(88% 0.06 267);
        border-radius: 24px;
        text-align: center;
        transition: all 0.4s ease;
      }

      .landing-pricing-card.featured {
        background: linear-gradient(135deg, oklch(97% 0.03 267), oklch(94% 0.05 252));
        border-color: var(--ana-1);
        transform: scale(1.05);
        box-shadow: 0 24px 80px oklch(47% 0.118 222 / 0.2);
      }

      .landing-pricing-badge {
        position: absolute;
        top: -12px;
        left: 50%;
        transform: translateX(-50%);
        padding: 0.5rem 1.5rem;
        background: var(--ana-2);
        color: var(--ana-6);
        font-size: 0.75rem;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        border-radius: 100px;
      }

      /* FAQ */
      .landing-faq-item {
        border-bottom: 1px solid oklch(88% 0.06 267);
        padding: 2rem 0;
      }

      .landing-faq-question {
        width: 100%;
        background: none;
        border: none;
        text-align: left;
        font-family: 'Fraunces', Georgia, serif;
        font-size: 1.25rem;
        font-weight: 450;
        color: var(--ana-2);
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0;
      }

      .landing-faq-answer {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.4s ease, padding 0.4s ease;
      }

      .landing-faq-item.open .landing-faq-answer {
        max-height: 300px;
        padding-top: 1rem;
      }

      /* Dark sections */
      .landing-dark-section {
        background: var(--bg-dark);
        color: var(--ana-6);
        position: relative;
        overflow: hidden;
      }

      .landing-dark-section::before {
        content: '';
        position: absolute;
        inset: 0;
        background:
          radial-gradient(ellipse 60% 40% at 10% 90%, oklch(47% 0.118 222 / 0.3) 0%, transparent 50%),
          radial-gradient(ellipse 50% 30% at 90% 10%, oklch(57% 0.133 232 / 0.2) 0%, transparent 50%);
      }

      /* Animations */
      @keyframes landing-fadeInUp {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .landing-animate {
        opacity: 0;
        animation: landing-fadeInUp 0.8s ease forwards;
      }

      .landing-delay-1 { animation-delay: 0.1s; }
      .landing-delay-2 { animation-delay: 0.2s; }
      .landing-delay-3 { animation-delay: 0.3s; }
      .landing-delay-4 { animation-delay: 0.4s; }

      /* Responsive */
      @media (max-width: 768px) {
        .landing-pricing-card.featured { transform: none; }
        .subdomain-wrapper {
          flex-direction: column;
          border-radius: 16px;
          padding: 1rem;
        }
        .subdomain-wrapper input {
          text-align: center;
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div id="container"></div>
    <!-- NOTE: @clerk/clerk-react uses direct URL in import statement because
         Babel standalone doesn't properly resolve import maps for bare specifiers -->
    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@18.3.1",
          "react-dom": "https://esm.sh/react-dom@18.3.1?deps=react@18.3.1",
          "react-dom/client": "https://esm.sh/react-dom@18.3.1/client?deps=react@18.3.1",
          "react/jsx-runtime": "https://esm.sh/react@18.3.1/jsx-runtime",
          "use-fireproof": "https://esm.sh/use-fireproof@0.20.0-dev-preview-50?deps=react@18.3.1",
          "use-vibes": "https://esm.sh/use-vibes@0.18.9?deps=react@18.3.1"
        }
      }
    </script>
    <!-- Load React globally for menu components -->
    <script type="module">
      import * as React from "react";
      window.React = React;

      // === START useMobile ===
function useMobile() {
  const [isMobile, setIsMobile] = React.useState(() => {
    if (typeof window === "undefined") return false;
    return window.matchMedia("(max-width: 768px)").matches;
  });
  React.useEffect(() => {
    if (typeof window === "undefined") return;
    const mediaQuery = window.matchMedia("(max-width: 768px)");
    const handleChange = (e) => {
      setIsMobile(e.matches);
    };
    mediaQuery.addEventListener("change", handleChange);
    return () => mediaQuery.removeEventListener("change", handleChange);
  }, []);
  return isMobile;
}
// === END useMobile ===

      // === START Icons ===
function BackIcon({
  bgFill = "#fff",
  fill = "#2a2a2a",
  width = 44,
  height = 44
}) {
  return /* @__PURE__ */ React.createElement(
    "svg",
    {
      width,
      height,
      viewBox: "0 0 44 44",
      fill: "none",
      xmlns: "http://www.w3.org/2000/svg"
    },
    /* @__PURE__ */ React.createElement("circle", { cx: "22", cy: "22", r: "22", fill: bgFill }),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        d: "M13.5 22.95C13.5 23.25 13.605 23.504 13.82 23.711C14.035 23.918 14.301 24.02 14.613 24.02C14.918 24.02 15.172 23.918 15.387 23.711C15.602 23.504 15.711 23.25 15.711 22.95V11.7661L15.668 10.711L16.633 11.7661L17.641 12.797C17.828 12.996 18.086 13.094 18.414 13.094C18.699 13.094 18.941 13.008 19.133 12.828C19.328 12.649 19.422 12.414 19.422 12.129C19.422 11.985 19.395 11.856 19.336 11.742C19.281 11.629 19.195 11.516 19.078 11.399L15.387 7.81702C15.145 7.55902 14.879 7.43005 14.594 7.43005C14.309 7.43005 14.051 7.55902 13.82 7.81702L10.129 11.379C9.898 11.606 9.785 11.856 9.785 12.129C9.785 12.414 9.883 12.649 10.074 12.828C10.27 13.008 10.508 13.094 10.793 13.094C11.121 13.094 11.383 12.996 11.566 12.797L12.574 11.7661L13.543 10.711L13.5 11.7661V22.95ZM28.5 21.94V11.05C28.5 10.75 28.395 10.496 28.18 10.289C27.965 10.082 27.699 9.98 27.387 9.98C27.082 9.98 26.828 10.082 26.613 10.289C26.398 10.496 26.289 10.75 26.289 11.05V22.234L26.332 23.289L25.367 22.234L24.359 21.203C24.172 21.004 23.914 20.906 23.586 20.906C23.301 20.906 23.059 20.992 22.867 21.172C22.672 21.351 22.578 21.586 22.578 21.871C22.578 22.015 22.605 22.144 22.664 22.258C22.719 22.371 22.805 22.484 22.922 22.601L26.613 26.183C26.855 26.441 27.121 26.57 27.406 26.57C27.691 26.57 27.949 26.441 28.18 26.183L31.871 22.621C32.102 22.394 32.215 22.144 32.215 21.871C32.215 21.586 32.117 21.351 31.926 21.172C31.73 20.992 31.492 20.906 31.207 20.906C30.879 20.906 30.617 21.004 30.434 21.203L29.426 22.234L28.457 23.289L28.5 22.234V21.94Z",
        fill
      }
    )
  );
}

function LoginIcon({
  bgFill = "#fff",
  fill = "#2a2a2a",
  width = 44,
  height = 44
}) {
  return /* @__PURE__ */ React.createElement(
    "svg",
    {
      width,
      height,
      viewBox: "0 0 44 44",
      fill: "none",
      xmlns: "http://www.w3.org/2000/svg"
    },
    /* @__PURE__ */ React.createElement("circle", { cx: "22", cy: "22", r: "22", fill: bgFill }),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        d: "M21.895 25.562C23.266 25.578 24.508 25.226 25.618 24.519C26.731 23.812 27.61 22.843 28.27 21.613C28.926 20.382 29.254 19 29.254 17.468C29.254 16.023 28.926 14.699 28.27 13.496C27.61 12.297 26.723 11.332 25.61 10.613C24.493 9.88604 23.254 9.52704 21.895 9.52704C20.52 9.52704 19.278 9.88604 18.161 10.613C17.043 11.332 16.157 12.297 15.5 13.496C14.84 14.699 14.516 16.023 14.532 17.468C14.532 19 14.86 20.375 15.512 21.589C16.157 22.804 17.039 23.769 18.149 24.476C19.258 25.183 20.508 25.547 21.895 25.562ZM21.895 40.519C23.524 40.519 25.145 40.304 26.758 39.867C28.368 39.429 29.875 38.8 31.297 37.976C32.711 37.156 33.969 36.164 35.075 35.007C34.301 33.777 33.243 32.726 31.911 31.863C30.571 30.996 29.047 30.336 27.336 29.886C25.625 29.433 23.809 29.207 21.895 29.207C19.946 29.207 18.114 29.441 16.399 29.894C14.68 30.355 13.164 31.015 11.836 31.882C10.516 32.75 9.46498 33.789 8.69598 35.007C9.79298 36.164 11.059 37.156 12.485 37.976C13.911 38.8 15.418 39.429 17.024 39.867C18.625 40.304 20.25 40.519 21.895 40.519Z",
        fill
      }
    )
  );
}

function RemixIcon({
  bgFill = "#fff",
  fill = "#2a2a2a",
  width = 44,
  height = 44
}) {
  return /* @__PURE__ */ React.createElement(
    "svg",
    {
      width,
      height,
      viewBox: "0 0 44 44",
      fill: "none",
      xmlns: "http://www.w3.org/2000/svg"
    },
    /* @__PURE__ */ React.createElement("circle", { cx: "22", cy: "22", r: "22", fill: bgFill }),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        d: "M28.442 19.879C29.145 19.879 29.762 19.594 30.301 19.032C30.836 18.465 31.106 17.739 31.106 16.8521C31.106 15.9501 30.84 15.2151 30.309 14.6411C29.781 14.0671 29.156 13.782 28.442 13.782C27.742 13.782 27.129 14.0671 26.606 14.6411C26.086 15.2151 25.824 15.9501 25.824 16.8521C25.824 17.739 26.09 18.465 26.617 19.032C27.149 19.594 27.754 19.879 28.442 19.879ZM21.895 32.95C23.426 32.95 24.774 32.672 25.942 32.114C27.109 31.555 28.012 30.918 28.656 30.203C29.301 29.489 29.621 28.887 29.621 28.399C29.621 28.129 29.516 27.942 29.301 27.844C29.086 27.742 28.863 27.742 28.637 27.844C27.836 28.285 26.91 28.711 25.867 29.121C24.82 29.528 23.496 29.731 21.895 29.731C20.277 29.731 18.949 29.524 17.914 29.11C16.875 28.692 15.949 28.27 15.133 27.844C14.902 27.742 14.684 27.742 14.469 27.844C14.254 27.942 14.145 28.129 14.145 28.399C14.145 28.887 14.473 29.489 15.121 30.203C15.774 30.918 16.68 31.555 17.84 32.114C18.996 32.672 20.352 32.95 21.895 32.95ZM15.328 19.879C16.027 19.879 16.649 19.594 17.184 19.032C17.719 18.465 17.988 17.739 17.988 16.8521C17.988 15.9501 17.723 15.2151 17.195 14.6411C16.664 14.0671 16.043 13.782 15.328 13.782C14.625 13.782 14.016 14.0671 13.504 14.6411C12.988 15.2151 12.731 15.9501 12.731 16.8521C12.731 17.739 12.992 18.465 13.512 19.032C14.035 19.594 14.641 19.879 15.328 19.879Z",
        fill
      }
    )
  );
}

function InviteIcon({
  bgFill = "#fff",
  fill = "#2a2a2a",
  width = 44,
  height = 44
}) {
  return /* @__PURE__ */ React.createElement(
    "svg",
    {
      width,
      height,
      viewBox: "0 0 44 44",
      fill: "none",
      xmlns: "http://www.w3.org/2000/svg"
    },
    /* @__PURE__ */ React.createElement("circle", { cx: "22", cy: "22", r: "22", fill: bgFill }),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        d: "M21.894 24.02C22.199 24.02 22.453 23.918 22.668 23.711C22.883 23.504 22.992 23.25 22.992 22.95V11.7661L22.949 10.711L23.914 11.7661L24.922 12.797C25.109 12.996 25.367 13.094 25.695 13.094C25.98 13.094 26.222 13.008 26.414 12.828C26.609 12.649 26.703 12.414 26.703 12.129C26.703 11.985 26.676 11.856 26.617 11.742C26.562 11.629 26.476 11.516 26.359 11.399L22.668 7.81702C22.426 7.55902 22.16 7.43005 21.875 7.43005C21.59 7.43005 21.332 7.55902 21.101 7.81702L17.41 11.379C17.179 11.606 17.066 11.856 17.066 12.129C17.066 12.414 17.164 12.649 17.355 12.828C17.551 13.008 17.789 13.094 18.074 13.094C18.402 13.094 18.664 12.996 18.847 12.797L19.855 11.7661L20.824 10.711L20.781 11.7661V22.95C20.781 23.25 20.886 23.504 21.101 23.711C21.316 23.918 21.582 24.02 21.894 24.02ZM15.605 32.715H28.164C29.367 32.715 30.277 32.407 30.902 31.793C31.523 31.176 31.836 30.266 31.836 29.067V18.184C31.836 16.981 31.523 16.074 30.902 15.469C30.277 14.86 29.367 14.5551 28.164 14.5551H24.687V16.809H28.121C29.082 16.809 29.558 17.301 29.558 18.289V29C29.558 29.989 29.082 30.481 28.121 30.481H15.629C14.668 30.481 14.191 29.989 14.191 29V18.289C14.191 17.301 14.668 16.809 15.629 16.809H19.105V14.5551H15.605C14.418 14.5551 13.515 14.8641 12.89 15.4771C12.269 16.0941 11.957 16.996 11.957 18.184V29.067C11.957 30.266 12.269 31.176 12.89 31.793C13.515 32.407 14.418 32.715 15.605 32.715Z",
        fill
      }
    )
  );
}

function SettingsIcon({
  bgFill = "#fff",
  fill = "#2a2a2a",
  width = 44,
  height = 44
}) {
  return /* @__PURE__ */ React.createElement(
    "svg",
    {
      width,
      height,
      viewBox: "0 0 44 44",
      fill: "none",
      xmlns: "http://www.w3.org/2000/svg"
    },
    /* @__PURE__ */ React.createElement("circle", { cx: "22", cy: "22", r: "22", fill: bgFill }),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        d: "M21.894 26.925C22.816 26.925 23.656 26.699 24.418 26.246C25.176 25.797 25.785 25.187 26.242 24.422C26.695 23.66 26.926 22.816 26.926 21.894C26.926 20.972 26.695 20.129 26.242 19.363C25.785 18.601 25.176 17.992 24.418 17.543C23.656 17.09 22.816 16.863 21.894 16.863C20.965 16.863 20.117 17.09 19.359 17.543C18.598 17.992 17.992 18.601 17.543 19.363C17.09 20.129 16.867 20.972 16.867 21.894C16.867 22.816 17.09 23.66 17.543 24.422C17.992 25.187 18.598 25.797 19.359 26.246C20.117 26.699 20.965 26.925 21.894 26.925ZM20.582 36.785C20.215 36.785 19.902 36.683 19.648 36.48C19.398 36.273 19.226 35.988 19.129 35.617L18.3911 32.48C18.1131 32.386 17.844 32.285 17.578 32.183C17.312 32.078 17.059 31.968 16.82 31.855L14.0861 33.535C13.7731 33.726 13.4531 33.804 13.1251 33.777C12.7971 33.75 12.5041 33.609 12.2501 33.351L10.426 31.527C10.168 31.269 10.023 30.972 9.992 30.629C9.957 30.285 10.043 29.965 10.254 29.66L11.9221 26.937C11.8051 26.691 11.6951 26.441 11.5941 26.183C11.4881 25.925 11.398 25.672 11.32 25.414L8.16003 24.66C7.78903 24.574 7.50405 24.406 7.30505 24.152C7.10505 23.902 7.00403 23.59 7.00403 23.218V20.64C7.00403 20.281 7.10505 19.972 7.30505 19.722C7.50405 19.468 7.78903 19.301 8.16003 19.215L11.293 18.461C11.379 18.164 11.4761 17.89 11.5861 17.633C11.6951 17.379 11.7971 17.136 11.8911 16.906L10.223 14.144C10.023 13.828 9.93706 13.511 9.96106 13.187C9.98406 12.867 10.129 12.5739 10.394 12.3199L12.2501 10.48C12.5041 10.222 12.789 10.078 13.101 10.039C13.418 10 13.73 10.078 14.043 10.269L16.809 11.976C17.043 11.855 17.301 11.738 17.57 11.629C17.84 11.519 18.1131 11.4179 18.3911 11.3199L19.129 8.172C19.226 7.812 19.398 7.52695 19.648 7.31995C19.902 7.10895 20.215 7.00397 20.582 7.00397H23.207C23.578 7.00397 23.8871 7.10895 24.1411 7.31995C24.3911 7.52695 24.559 7.812 24.644 8.172L25.387 11.351C25.68 11.445 25.9571 11.5429 26.2191 11.6479C26.4801 11.7539 26.726 11.867 26.953 11.992L29.746 10.269C30.051 10.078 30.3551 10.008 30.6641 10.054C30.9731 10.101 31.262 10.242 31.527 10.48L33.394 12.3199C33.66 12.5739 33.801 12.867 33.82 13.187C33.84 13.511 33.754 13.828 33.566 14.144L31.8831 16.906C31.9761 17.136 32.082 17.379 32.191 17.633C32.297 17.89 32.402 18.164 32.496 18.461L35.629 19.215C35.992 19.301 36.273 19.468 36.476 19.722C36.683 19.972 36.785 20.281 36.785 20.64V23.218C36.785 23.59 36.683 23.902 36.476 24.152C36.273 24.406 35.992 24.574 35.629 24.66L32.4691 25.414C32.3831 25.672 32.289 25.925 32.191 26.183C32.09 26.441 31.976 26.691 31.855 26.937L33.535 29.66C33.746 29.965 33.832 30.285 33.801 30.629C33.766 30.972 33.621 31.269 33.367 31.527L31.527 33.351C31.269 33.609 30.976 33.75 30.652 33.777C30.324 33.804 30.008 33.726 29.703 33.535L26.953 31.855C26.715 31.968 26.465 32.078 26.199 32.183C25.933 32.285 25.66 32.386 25.387 32.48L24.644 35.617C24.559 35.988 24.3911 36.273 24.1411 36.48C23.8871 36.683 23.578 36.785 23.207 36.785H20.582Z",
        fill
      }
    )
  );
}
// === END Icons ===

      // === START VibesSwitch ===
const switchColors = {
  primary: "var(--vibes-black)",
  secondary: "var(--vibes-white)"
};

function VibesSwitch({
  size = 24,
  className,
  isActive,
  onToggle
}) {
  const [internalActive, setInternalActive] = React.useState(true);
  const logicalActive = isActive !== void 0 ? isActive : internalActive;
  const active = !logicalActive;
  const handlePointerDown = (e) => {
    e.stopPropagation();
    e.preventDefault();
    const newState = !logicalActive;
    if (onToggle) {
      onToggle(newState);
    }
    if (isActive === void 0) {
      setInternalActive(newState);
    }
  };
  const originalD = `M426.866,285.985c-7.999-0.416-19.597-0.733-31.141-1.687  c-15.692-1.297-28.809-8.481-40.105-19.104c-12.77-12.008-20.478-26.828-22.714-44.177c-3.048-23.644,3.384-44.558,19.646-62.143  c9.174-9.92,20.248-17.25,33.444-20.363c7.786-1.837,15.944-2.399,23.973-2.828c9.988-0.535,20.023-0.666,30.021-0.371  c10.191,0.301,20.433,0.806,30.521,2.175c12.493,1.696,23.132,7.919,32.552,16.091c14.221,12.337,22.777,27.953,25.184,46.594  c2.822,21.859-2.605,41.617-16.777,58.695c-9.494,11.441-21.349,19.648-35.722,23.502c-6.656,1.785-13.724,2.278-20.647,2.77  C446.914,285.721,438.682,285.667,426.866,285.985z`;
  const stretchedD = `M165.866,285.985c-7.999-0.416-19.597-0.733-31.141-1.687  c-15.692-1.297-28.809-8.481-40.105-19.104c-12.77-12.008-20.478-26.828-22.714-44.177c-3.048-23.644,3.384-44.558,19.646-62.143  c9.174-9.92,20.248-17.25,33.444-20.363c7.786-1.837,15.944-2.399,23.973-2.828c9.988-0.535,121.023-0.666,131.021-0.371  c10.191,0.301,20.433,0.806,30.521,2.175c12.493,1.696,23.132,7.919,32.552,16.091c14.221,12.337,22.777,27.953,25.184,46.594  c2.822,21.859-2.605,41.617-16.777,58.695c-9.494,11.441-21.349,19.648-35.722,23.502c-6.656,1.785-13.724,2.278-20.647,2.77  C286.914,285.721,177.682,285.667,165.866,285.985z`;
  return /* @__PURE__ */ React.createElement(
    "svg",
    {
      xmlns: "http://www.w3.org/2000/svg",
      height: size,
      viewBox: "0 0 600 300",
      fill: "currentColor",
      className,
      onPointerDown: handlePointerDown
    },
    /* @__PURE__ */ React.createElement(
      "path",
      {
        fillRule: "evenodd",
        clipRule: "evenodd",
        fill: "#000",
        d: "M293.353,298.09c-41.038,0-82.078,0.125-123.115-0.077  c-11.993-0.06-24.011-0.701-35.964-1.703c-15.871-1.331-29.73-7.937-41.948-17.946c-16.769-13.736-27.207-31.417-30.983-52.7  c-4.424-24.93,1.404-47.685,16.506-67.913c11.502-15.407,26.564-26.1,45.258-30.884c7.615-1.949,15.631-2.91,23.501-3.165  c20.08-0.652,40.179-0.853,60.271-0.879c69.503-0.094,139.007-0.106,208.51,0.02c14.765,0.026,29.583,0.097,44.28,1.313  c36.984,3.059,61.78,23.095,74.653,57.301c17.011,45.199-8.414,96.835-54.29,111.864c-7.919,2.595-16.165,3.721-24.434,3.871  c-25.614,0.467-51.234,0.742-76.853,0.867C350.282,298.197,321.817,298.09,293.353,298.09z"
      }
    ),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        fill: "#fff",
        fillRule: "evenodd",
        clipRule: "evenodd",
        d: active ? stretchedD : originalD,
        style: {
          transition: "d 0.3s ease, transform 0.8s ease, fill 2s ease",
          transform: active ? "translateX(3px) " : "none"
        }
      }
    ),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        fillRule: "evenodd",
        clipRule: "evenodd",
        style: {
          transition: "fill 0.5s ease",
          fill: active ? switchColors.primary : switchColors.secondary
        },
        d: "M181.891,205.861c0-5.043-0.001-10.086,0-15.129  c0.001-5.046,1.679-7.539,6.606-7.695c9.292-0.294,18.653-1.051,27.888,0.707c7.614,1.449,11.523,5.954,11.902,13.446  c0.066,1.312-0.313,2.752-0.857,3.966c-1.401,3.123-1.399,6.266-0.673,9.507c0.301,1.342,0.443,2.723,0.787,4.053  c1.274,4.925-1.78,10.114-6.085,11.937c-3.111,1.318-6.561,2.327-9.909,2.497c-7.303,0.37-14.639,0.136-21.96,0.101  c-1.165-0.005-2.345-0.181-3.488-0.422c-2.657-0.56-4.162-2.962-4.197-6.801C181.854,216.639,181.891,211.25,181.891,205.861z   M204.442,192.385c-2.757,0-5.514,0-8.271,0c-3.695,0-5.151,1.669-4.712,5.403c0.369,3.14,1.05,3.735,4.225,3.737  c5.024,0.004,10.05,0.109,15.07-0.014c2.028-0.05,4.167-0.27,6.04-0.98c3.182-1.207,3.639-4.256,1.008-6.455  c-1.073-0.896-2.659-1.509-4.06-1.618C210.659,192.22,207.544,192.385,204.442,192.385z M204.334,211.104c0,0.045,0,0.091,0,0.137  c-3.101,0-6.203-0.055-9.302,0.037c-0.823,0.024-2.257,0.373-2.344,0.794c-0.447,2.154-0.959,4.444-0.639,6.563  c0.276,1.822,2.447,1.451,3.882,1.441c5.989-0.042,11.98-0.118,17.961-0.385c1.416-0.063,2.859-0.79,4.176-1.441  c1.79-0.886,1.833-2.475,1.029-4.046c-1.166-2.276-3.297-3.024-5.677-3.081C210.394,211.049,207.363,211.104,204.334,211.104z"
      }
    ),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        fillRule: "evenodd",
        clipRule: "evenodd",
        style: {
          transition: "fill 0.8s ease",
          fill: active ? switchColors.primary : switchColors.secondary
        },
        d: "M291.409,229.748c-3.621-0.394-7.838-0.587-11.94-1.379  c-3.577-0.69-6.343-2.991-8.213-6.163c-1.763-2.99-0.301-5.6,3.139-5.292c2.287,0.205,4.512,1.129,6.758,1.755  c6.281,1.751,12.643,1.892,19.053,0.951c0.667-0.098,1.31-0.416,1.941-0.686c1.502-0.644,2.55-1.682,2.581-3.415  c0.031-1.74-1.195-2.749-2.579-3.132c-2.298-0.637-4.688-1.021-7.065-1.273c-5.062-0.536-10.252-0.401-15.187-1.475  c-9.677-2.105-11.678-10.53-10.101-16.009c1.62-5.625,5.911-8.92,11.318-9.73c8.388-1.257,16.925-1.491,25.279,0.654  c3.702,0.951,6.615,3.072,7.883,6.931c0.918,2.792-0.332,4.6-3.268,4.357c-1.684-0.139-3.367-0.676-4.974-1.248  c-6.711-2.387-13.572-2.897-20.569-1.783c-1.001,0.159-2.146,0.414-2.875,1.034c-0.901,0.766-2.016,1.981-1.98,2.964  c0.041,1.128,0.995,2.733,1.991,3.206c1.81,0.857,3.925,1.279,5.948,1.441c5.152,0.41,10.356,0.296,15.479,0.905  c7.98,0.949,13.779,9.833,11.241,17.125c-1.959,5.628-6.44,8.489-12.143,9.322C299.455,229.344,295.715,229.419,291.409,229.748z"
      }
    ),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        fillRule: "evenodd",
        clipRule: "evenodd",
        style: {
          transition: "fill 1.2s ease",
          fill: active ? switchColors.primary : switchColors.secondary
        },
        d: "M235.786,208.14c0-6.905-0.01-13.809,0.004-20.714  c0.007-3.474,0.948-4.428,4.415-3.758c6.62,1.279,13.232,2.651,19.759,4.331c1.7,0.438,3.404,1.896,4.515,3.341  c1.777,2.31,0.433,5.367-2.463,5.745c-1.86,0.243-3.819-0.138-5.717-0.368c-2.183-0.264-4.339-0.783-6.525-0.976  c-1.572-0.138-3.065,0.375-3.8,1.959c-0.76,1.638-0.319,3.329,0.942,4.34c1.619,1.296,3.522,2.327,5.447,3.128  c2.146,0.894,4.539,1.207,6.66,2.145c1.446,0.64,2.982,1.687,3.786,2.981c0.689,1.11,0.928,3.094,0.378,4.202  c-0.492,0.991-2.32,1.795-3.579,1.825c-2.238,0.052-4.483-0.652-6.741-0.832c-1.614-0.127-3.333-0.203-4.865,0.212  c-2.574,0.699-3.225,3.013-1.719,5.218c1.396,2.044,3.431,3.141,5.757,3.761c2.791,0.744,5.637,1.315,8.373,2.222  c3.19,1.058,4.791,3.496,4.801,6.723c0.011,3.365-1.759,5.021-5.138,4.424c-4.402-0.778-8.759-1.81-13.134-2.735  c-2.357-0.499-4.718-0.981-7.069-1.511c-3.263-0.737-4.132-1.805-4.141-5.154c-0.019-6.836-0.006-13.672-0.006-20.508  C235.747,208.141,235.766,208.14,235.786,208.14z"
      }
    ),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        fillRule: "evenodd",
        clipRule: "evenodd",
        style: {
          transition: "fill 0.6s ease",
          fill: active ? switchColors.primary : switchColors.secondary
        },
        d: "M135.138,229.842c-2.941-0.084-5.296-1.462-6.684-3.9  c-1.827-3.21-3.328-6.618-4.81-10.011c-3.55-8.128-7.021-16.291-10.486-24.455c-0.48-1.132-0.902-2.329-1.087-3.536  c-0.417-2.72,1.238-4.585,3.938-4.119c1.591,0.275,3.569,0.98,4.45,2.173c2.226,3.015,4.175,6.299,5.784,9.69  c2.208,4.654,3.898,9.552,6.032,14.244c0.628,1.379,2.009,2.416,3.045,3.609c0.892-1.159,2.042-2.201,2.63-3.498  c2.697-5.953,5.22-11.985,7.841-17.974c1.423-3.252,3.089-6.418,6.532-7.905c1.238-0.535,3.012-0.712,4.184-0.214  c0.81,0.344,1.377,2.126,1.385,3.271c0.009,1.458-0.479,2.997-1.059,4.371c-4.227,10.013-8.504,20.005-12.833,29.974  c-0.79,1.819-1.762,3.589-2.875,5.229C139.73,228.848,137.671,229.894,135.138,229.842z"
      }
    ),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        fillRule: "evenodd",
        clipRule: "evenodd",
        style: {
          transition: "fill 1.3s ease",
          fill: active ? switchColors.primary : switchColors.secondary
        },
        d: "M164.636,206.263c0-6.691,0.054-13.383-0.036-20.073  c-0.024-1.851,0.716-2.67,2.449-2.81c0.274-0.022,0.549-0.054,0.823-0.076c5.488-0.445,6.091,0.105,6.091,5.562  c0,12.348,0,24.695,0,37.043c0,2.887-0.354,3.405-3.222,3.618c-1.628,0.121-3.338-0.001-4.91-0.408  c-0.593-0.153-1.265-1.408-1.278-2.171c-0.096-5.584-0.034-11.172-0.022-16.759c0.002-1.308,0-2.617,0-3.926  C164.566,206.263,164.601,206.263,164.636,206.263z"
      }
    ),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        fillRule: "evenodd",
        clipRule: "evenodd",
        style: {
          transition: "fill 1s ease",
          fill: active ? switchColors.secondary : switchColors.primary
        },
        d: "M388.313,210.147c0-6.356,0.034-12.713-0.023-19.069  c-0.015-1.61,0.359-2.472,2.19-2.346c2.887,0.198,5.809,0.045,8.671,0.398c4.396,0.542,8.019,4.294,8.144,8.904  c0.223,8.142,0.265,16.304-0.074,24.439c-0.248,5.945-4.552,9.662-10.491,9.831c-1.999,0.057-4.003-0.081-6.006-0.09  c-1.746-0.008-2.439-0.853-2.428-2.584C388.34,223.136,388.313,216.642,388.313,210.147z M393.418,210.324c-0.037,0-0.075,0-0.114,0  c0,4.55-0.038,9.101,0.015,13.65c0.031,2.688,0.926,3.439,3.56,3.239c3.273-0.248,5.493-2.511,5.534-6.04  c0.082-7.099,0.054-14.2-0.033-21.299c-0.041-3.268-1.739-5.241-4.87-6.092c-2.68-0.728-4.025,0.161-4.07,2.896  C393.364,201.226,393.418,205.775,393.418,210.324z"
      }
    ),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        fillRule: "evenodd",
        clipRule: "evenodd",
        style: {
          transition: "fill 1s ease",
          fill: active ? switchColors.secondary : switchColors.primary
        },
        d: "M478.079,200.8c0.674-1.566,1.121-2.53,1.506-3.519  c0.673-1.73,1.252-3.5,1.981-5.205c0.315-0.737,0.766-1.654,1.407-1.961c1.094-0.523,2.388-0.63,3.598-0.912  c0.205,1.142,0.798,2.381,0.537,3.404c-0.606,2.388-1.448,4.756-2.507,6.984c-3.981,8.389-4.352,17.254-3.78,26.282  c0.091,1.438,0.031,2.899-0.105,4.335c-0.14,1.473-0.989,2.428-2.542,2.497c-1.514,0.067-2.311-0.903-2.54-2.23  c-0.232-1.348-0.394-2.754-0.277-4.108c0.94-10.972-1.116-21.38-5.626-31.375c-0.586-1.298-0.899-2.762-1.093-4.183  c-0.233-1.712,0.825-2.592,2.379-1.843c1.164,0.561,2.345,1.55,2.973,2.657c1.078,1.897,1.712,4.043,2.568,6.07  C476.918,198.547,477.37,199.361,478.079,200.8z"
      }
    ),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        fillRule: "evenodd",
        clipRule: "evenodd",
        style: {
          transition: "fill 1s ease",
          fill: active ? switchColors.secondary : switchColors.primary
        },
        d: "M440.516,210.627c0,6.281,0.007,12.563-0.004,18.844  c-0.004,2.067-0.805,3.038-2.531,3.015c-1.877-0.025-2.365-1.136-2.359-2.876c0.046-12.631,0.019-25.263,0.029-37.895  c0.002-2.592,0.525-3.205,2.419-3.148c1.856,0.057,2.479,1.03,2.466,2.803C440.484,197.788,440.515,204.208,440.516,210.627z"
      }
    ),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        fillRule: "evenodd",
        clipRule: "evenodd",
        style: {
          transition: "fill 1s ease",
          fill: active ? switchColors.secondary : switchColors.primary
        },
        d: "M416.875,210.721c0.068-3.305,1.849-5.306,4.727-5.309  c2.765-0.003,4.924,2.404,4.816,5.371c-0.106,2.956-2.355,5.212-5.12,5.138C418.626,215.849,416.813,213.718,416.875,210.721z"
      }
    ),
    /* @__PURE__ */ React.createElement(
      "path",
      {
        fillRule: "evenodd",
        clipRule: "evenodd",
        style: {
          transition: "fill 1s ease",
          fill: active ? switchColors.secondary : switchColors.primary
        },
        d: "M449.933,210.636c0.102-3.331,1.886-5.279,4.778-5.22  c2.67,0.055,4.829,2.432,4.762,5.243c-0.073,3.021-2.404,5.36-5.242,5.261C451.606,215.829,449.84,213.657,449.933,210.636z"
      }
    )
  );
}
// === END VibesSwitch ===

      // === START HiddenMenuWrapper ===
if (typeof document !== "undefined") {
  const styleId = "hidden-menu-wrapper-vars";
  if (!document.getElementById(styleId)) {
    const style = document.createElement("style");
    style.id = styleId;
    style.textContent = `
      :root {
        --hm-menu-bg: var(--vibes-gray-lightest);
        --hm-menu-text: var(--vibes-white);
        --hm-content-bg: #1e1e1e;
        --hm-shadow: rgba(0, 0, 0, 0.3);
        --hm-grid-line: rgba(255, 255, 255, 0.5);
      }

      @media (prefers-color-scheme: dark) {
        :root {
          --hm-menu-bg: #2a2a2a;
          --hm-menu-text: var(--vibes-gray-ultralight);
          --hm-content-bg: var(--vibes-near-black);
          --hm-shadow: rgba(255, 255, 255, 0.1);
        }
      }
    `;
    document.head.appendChild(style);
  }
}
const hiddenMenuTheme = {
  colors: {
    menuBg: "var(--hm-menu-bg, var(--vibes-gray-lightest))",
    menuText: "var(--hm-menu-text, var(--vibes-white))",
    contentBg: "var(--hm-content-bg, #1e1e1e)",
    shadow: "var(--hm-shadow, rgba(0, 0, 0, 0.3))",
    gridLineColor: "var(--hm-grid-line, rgba(255, 255, 255, 0.5))"
  },
  zIndex: {
    menu: 5,
    content: 10,
    toggle: 20
  },
  dimensions: {
    gridSize: "40px",
    padding: "24px",
    bottomOffset: "16px"
  },
  animation: {
    duration: "0.4s",
    easing: "ease",
    blurAmount: "4px"
  }
};
const getWrapperStyle = () => ({
  position: "relative",
  overflow: "hidden"
});
const getMenuStyle = () => ({
  position: "fixed",
  bottom: 0,
  left: 0,
  right: 0,
  zIndex: hiddenMenuTheme.zIndex.menu,
  color: hiddenMenuTheme.colors.menuText,
  padding: hiddenMenuTheme.dimensions.padding,
  boxShadow: `0 -2px 10px ${hiddenMenuTheme.colors.shadow}`,
  backgroundColor: hiddenMenuTheme.colors.menuBg,
  backgroundImage: `
    linear-gradient(${hiddenMenuTheme.colors.gridLineColor} 1px, transparent 1px),
    linear-gradient(90deg, ${hiddenMenuTheme.colors.gridLineColor} 1px, transparent 1px)
  `,
  backgroundSize: hiddenMenuTheme.dimensions.gridSize + " " + hiddenMenuTheme.dimensions.gridSize
});
const getContentStyle = () => ({
  filter: "none",
  width: "100%",
  height: "100%"
});
const getContentWrapperStyle = (menuHeight, menuOpen, isBouncing) => ({
  position: "fixed",
  top: 0,
  left: 0,
  right: 0,
  bottom: 0,
  zIndex: hiddenMenuTheme.zIndex.content,
  transition: isBouncing ? `filter 0.3s ${hiddenMenuTheme.animation.easing}` : `transform ${hiddenMenuTheme.animation.duration} ${hiddenMenuTheme.animation.easing}, filter 0.3s ${hiddenMenuTheme.animation.easing}`,
  transform: menuOpen ? `translateY(-${menuHeight}px)` : "translateY(0)",
  overflowY: "auto",
  borderTopColor: hiddenMenuTheme.colors.menuBg,
  borderTopWidth: "1px",
  borderTopStyle: "solid",
  boxShadow: `0 -2px 10px ${hiddenMenuTheme.colors.shadow}`,
  backgroundColor: hiddenMenuTheme.colors.contentBg,
  animation: isBouncing ? "vibes-drop-to-close 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)" : void 0,
  willChange: isBouncing ? "transform" : void 0
});
const getInnerContentWrapperStyle = (menuOpen) => ({
  filter: menuOpen ? `blur(${hiddenMenuTheme.animation.blurAmount})` : "none",
  width: "100%",
  height: "100%"
});
const getToggleButtonStyle = () => ({
  position: "fixed",
  bottom: hiddenMenuTheme.dimensions.bottomOffset,
  right: 0,
  zIndex: hiddenMenuTheme.zIndex.toggle,
  backgroundColor: "transparent",
  border: "none",
  cursor: "pointer"
});

function HiddenMenuWrapper({
  children,
  menuContent,
  triggerBounce,
  showVibesSwitch = true
}) {
  const [menuOpen, setMenuOpen] = React.useState(false);
  const [menuHeight, setMenuHeight] = React.useState(0);
  const menuRef = React.useRef(null);
  const buttonRef = React.useRef(null);
  const menuContainerRef = React.useRef(null);
  const rafIdRef = React.useRef(null);
  const cancelRef = React.useRef(null);
  const [isBouncing, setIsBouncing] = React.useState(false);
  const [hasBouncedOnMount, setHasBouncedOnMount] = React.useState(false);
  React.useEffect(() => {
    if (!hasBouncedOnMount && !menuOpen) {
      const prefersReducedMotion = window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches || false;
      if (!prefersReducedMotion) {
        setIsBouncing(true);
        setTimeout(() => setIsBouncing(false), 800);
      }
      setHasBouncedOnMount(true);
    }
  }, [hasBouncedOnMount, menuOpen]);
  React.useEffect(() => {
    const styleId = "vibes-drop-to-close-keyframes";
    const existingStyle = document.getElementById(styleId);
    if (!existingStyle) {
      const style = document.createElement("style");
      style.id = styleId;
      style.textContent = `
        @keyframes vibes-drop-to-close {
          0%   { transform: translateY(-400px); }  /* Start pushed up */
          10%  { transform: translateY(0); }       /* First big drop */
          25%  { transform: translateY(-175px); }   /* First bounce back up */
          35%  { transform: translateY(0); }       /* Second drop */
          48%  { transform: translateY(-75px); }   /* Second bounce back up */
          62%  { transform: translateY(0); }       /* Third drop */
          72%  { transform: translateY(-25px); }   /* Third bounce back up */
          80%  { transform: translateY(0); }       /* Fourth drop - faster */
          82%  { transform: translateY(-10px); }   /* Fourth bounce back up - much faster */
          88%  { transform: translateY(0); }       /* Fifth drop */
          91%  { transform: translateY(-5px); }    /* Final tiny bounce back up */
          95%  { transform: translateY(0); }       /* Final settle */
          100% { transform: translateY(0); }
        }
      `;
      document.head.appendChild(style);
    }
  }, []);
  React.useEffect(() => {
    if (triggerBounce) {
      setIsBouncing(true);
      const timeout = setTimeout(() => setIsBouncing(false), 800);
      return () => clearTimeout(timeout);
    }
  }, [triggerBounce]);
  React.useEffect(() => {
    if (menuRef.current) {
      const next = menuRef.current.offsetHeight;
      setMenuHeight((prev) => prev !== next ? next : prev);
    }
  }, [menuContent]);
  React.useEffect(() => {
    const handleKeyDown = (e) => {
      if (e.key === "Escape" && menuOpen) {
        setMenuOpen(false);
        buttonRef.current?.focus();
      }
      if (menuOpen && e.key === "Tab" && menuContainerRef.current) {
        const focusableElements = menuContainerRef.current.querySelectorAll(
          'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
        );
        const first = focusableElements[0];
        const last = focusableElements[focusableElements.length - 1];
        if (!first || !last) return;
        if (e.shiftKey) {
          if (document.activeElement === first) {
            e.preventDefault();
            last.focus();
          }
        } else {
          if (document.activeElement === last) {
            e.preventDefault();
            first.focus();
          }
        }
      }
    };
    document.addEventListener("keydown", handleKeyDown);
    return () => document.removeEventListener("keydown", handleKeyDown);
  }, [menuOpen]);
  React.useEffect(() => {
    if (menuOpen) {
      const firstFocusable = menuRef.current?.querySelector(
        'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
      );
      firstFocusable?.focus();
    }
  }, [menuOpen]);
  const useIsomorphicLayoutEffect = typeof window !== "undefined" ? React.useLayoutEffect : useEffect;
  useIsomorphicLayoutEffect(() => {
    const menuEl = menuRef.current;
    if (!menuEl) return;
    const scheduleSetHeight = (h) => {
      if (rafIdRef.current != null && cancelRef.current) {
        cancelRef.current(rafIdRef.current);
        rafIdRef.current = null;
      }
      const run = () => setMenuHeight((prev) => prev !== h ? h : prev);
      if (typeof requestAnimationFrame !== "undefined") {
        const id = requestAnimationFrame(() => run());
        rafIdRef.current = id;
        cancelRef.current = (cancelId) => cancelAnimationFrame(cancelId);
      } else {
        const id = setTimeout(run, 0);
        rafIdRef.current = id;
        cancelRef.current = (cancelId) => clearTimeout(cancelId);
      }
    };
    scheduleSetHeight(menuEl.offsetHeight);
    if (typeof window.ResizeObserver !== "undefined") {
      const RO = window.ResizeObserver;
      const resizeObserver = new RO(() => {
        scheduleSetHeight(menuEl.offsetHeight);
      });
      resizeObserver.observe(menuEl);
      return () => {
        resizeObserver.disconnect();
        if (rafIdRef.current != null && cancelRef.current) {
          cancelRef.current(rafIdRef.current);
          rafIdRef.current = null;
        }
      };
    }
    const mutationObserver = new MutationObserver(() => {
      scheduleSetHeight(menuEl.offsetHeight);
    });
    mutationObserver.observe(menuEl, { childList: true, subtree: true });
    const onResize = () => scheduleSetHeight(menuEl.offsetHeight);
    window.addEventListener("resize", onResize);
    window.addEventListener("orientationchange", onResize);
    return () => {
      mutationObserver.disconnect();
      window.removeEventListener("resize", onResize);
      window.removeEventListener("orientationchange", onResize);
      if (rafIdRef.current != null && cancelRef.current) {
        cancelRef.current(rafIdRef.current);
        rafIdRef.current = null;
      }
    };
  }, []);
  React.useEffect(() => {
    const menuEl = menuRef.current;
    if (!menuEl) return;
    const defer = (cb) => {
      if (typeof queueMicrotask === "function") {
        queueMicrotask(cb);
      } else if (typeof requestAnimationFrame !== "undefined") {
        requestAnimationFrame(cb);
      } else {
        setTimeout(cb, 0);
      }
    };
    defer(() => {
      const next = menuEl.offsetHeight;
      setMenuHeight((prev) => prev !== next ? next : prev);
    });
  }, [menuOpen]);
  return /* @__PURE__ */ React.createElement("div", { style: getWrapperStyle() }, /* @__PURE__ */ React.createElement(
    "div",
    {
      id: "hidden-menu",
      role: "dialog",
      "aria-modal": "true",
      "aria-label": "Hidden menu",
      "aria-hidden": !menuOpen,
      ref: menuRef,
      style: getMenuStyle()
    },
    menuContent
  ), /* @__PURE__ */ React.createElement(
    "div",
    {
      style: getContentWrapperStyle(menuHeight, menuOpen, isBouncing),
      ref: menuContainerRef
    },
    /* @__PURE__ */ React.createElement("div", { style: getInnerContentWrapperStyle(menuOpen) }, /* @__PURE__ */ React.createElement("div", { style: getContentStyle() }, children))
  ), showVibesSwitch && /* @__PURE__ */ React.createElement(
    "button",
    {
      "aria-haspopup": "dialog",
      "aria-expanded": menuOpen,
      "aria-controls": "hidden-menu",
      ref: buttonRef,
      onClick: () => setMenuOpen(!menuOpen),
      style: getToggleButtonStyle()
    },
    /* @__PURE__ */ React.createElement(VibesSwitch, { size: 80 })
  ));
}
// === END HiddenMenuWrapper ===

      // === START VibesButton ===
const variantColors = {
  blue: "var(--vibes-variant-blue)",
  red: "var(--vibes-variant-red)",
  yellow: "var(--vibes-variant-yellow)",
  gray: "var(--vibes-variant-gray)"
};
function getVariantColor(variant) {
  return variantColors[variant] || variant;
}
const bounceKeyframes = `
  @keyframes vibes-button-bounce {
    0%, 100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-8px);
    }
  }
`;
function getButtonStyle(variant, isHovered, isActive, isMobile = false, hasIcon) {
  const cssColor = getVariantColor(variant);
  let transform = "translate(0px, 0px)";
  let boxShadow = `8px 10px 0px 0px ${cssColor}, 8px 10px 0px 2px var(--vibes-button-border)`;
  if (isHovered && !isActive) {
    transform = "translate(2px, 2px)";
    boxShadow = `2px 3px 0px 0px ${cssColor}, 2px 3px 0px 2px var(--vibes-button-border)`;
  }
  if (isActive) {
    transform = "translate(4px, 5px)";
    boxShadow = "none";
  }
  return {
    width: !hasIcon ? "auto" : isMobile ? "100%" : "150px",
    height: !hasIcon ? "auto" : isMobile ? "auto" : "150px",
    minHeight: isMobile ? "60px" : void 0,
    padding: isMobile ? "0.75rem 1.5rem" : "1rem 2rem",
    borderRadius: "12px",
    fontSize: "1rem",
    fontWeight: 700,
    textTransform: "uppercase",
    letterSpacing: "0.05em",
    cursor: "pointer",
    transition: "all 0.15s ease",
    position: "relative",
    transform,
    boxShadow
  };
}
function getMergedButtonStyle(baseStyle, ignoreDarkMode, customStyle) {
  return {
    ...baseStyle,
    background: ignoreDarkMode ? "var(--vibes-button-bg)" : "var(--vibes-button-bg-dark-aware)",
    color: ignoreDarkMode ? "var(--vibes-button-text)" : "var(--vibes-button-text-dark-aware)",
    border: ignoreDarkMode ? "2px solid var(--vibes-button-border)" : "2px solid var(--vibes-button-border-dark-aware)",
    ...customStyle
  };
}
function getIconContainerStyle(variant, isMobile, hasIcon) {
  if (!hasIcon) return {};
  const cssColor = getVariantColor(variant);
  return {
    width: isMobile ? "48px" : "80px",
    height: isMobile ? "48px" : "80px",
    backgroundColor: cssColor,
    borderRadius: "8px",
    display: "flex",
    alignItems: "center",
    justifyContent: "center",
    flexShrink: 0,
    border: "2px solid var(--vibes-black)"
  };
}
function getIconStyle(isMobile, isHovered, isActive) {
  return {
    width: isMobile ? "28px" : "50px",
    height: isMobile ? "28px" : "50px",
    display: "flex",
    alignItems: "center",
    justifyContent: "center",
    animation: isHovered && !isActive ? "vibes-button-bounce 0.8s ease-in-out infinite" : "none"
  };
}
function getButtonContentWrapperStyle(isMobile, hasIcon) {
  if (!hasIcon) return {};
  return {
    display: "flex",
    alignItems: "center",
    gap: isMobile ? "16px" : "6px",
    flexDirection: isMobile ? "row" : "column",
    justifyContent: isMobile ? "flex-start" : "center",
    width: "100%"
  };
}

const BLUE = "blue";
const RED = "red";
const YELLOW = "yellow";
const GRAY = "gray";
const iconMap = {
  login: LoginIcon,
  remix: RemixIcon,
  invite: InviteIcon,
  settings: SettingsIcon,
  back: BackIcon
};
function VibesButton({
  variant = "blue",
  children,
  onHover,
  onUnhover,
  icon,
  style: customStyle,
  className = "",
  ignoreDarkMode = false,
  ...props
}) {
  const buttonVariant = variant;
  const [isHovered, setHovered] = React.useState(false);
  const [isActive, setActive] = React.useState(false);
  const isMobile = useMobile();
  React.useEffect(() => {
    if (isHovered) {
      onHover?.();
    } else {
      onUnhover?.();
    }
  }, [isHovered, onHover, onUnhover]);
  const IconComponent = icon ? iconMap[icon] : void 0;
  const baseStyle = getButtonStyle(
    buttonVariant,
    isHovered,
    isActive,
    isMobile,
    !!IconComponent
  );
  const mergedStyle = getMergedButtonStyle(
    baseStyle,
    ignoreDarkMode,
    customStyle
  );
  const iconContainerStyle = getIconContainerStyle(
    buttonVariant,
    isMobile,
    !!IconComponent
  );
  const iconStyle = getIconStyle(isMobile, isHovered, isActive);
  const contentWrapperStyle = getButtonContentWrapperStyle(isMobile, !!IconComponent);
  return /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement("style", null, bounceKeyframes), /* @__PURE__ */ React.createElement(
    "button",
    {
      ...props,
      className,
      onMouseEnter: () => setHovered(true),
      onMouseLeave: () => {
        setHovered(false);
        setActive(false);
      },
      onMouseDown: () => setActive(true),
      onMouseUp: () => setActive(false),
      style: mergedStyle
    },
    IconComponent ? /* @__PURE__ */ React.createElement("div", { style: contentWrapperStyle }, /* @__PURE__ */ React.createElement("div", { style: iconContainerStyle }, /* @__PURE__ */ React.createElement("div", { style: iconStyle }, /* @__PURE__ */ React.createElement(
      IconComponent,
      {
        bgFill: "var(--vibes-button-icon-bg)",
        fill: "var(--vibes-button-icon-fill)",
        width: isMobile ? 28 : 50,
        height: isMobile ? 28 : 50
      }
    ))), /* @__PURE__ */ React.createElement("span", null, children)) : children
  ));
}
// === END VibesButton ===

      // === START VibesPanel ===
      function VibesPanel() {
        return React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: "12px", alignItems: "center", maxWidth: "400px", margin: "0 auto" } },
          React.createElement(VibesButton, { variant: "blue", href: "https://vibes.diy" }, "VISIT VIBES.DIY"),
          React.createElement(VibesButton, { variant: "yellow", href: "https://vibes.diy" }, "CREATE YOUR OWN")
        );
      }
      window.VibesPanel = VibesPanel;
      // === END VibesPanel ===

      // Expose all menu components globally for Babel scripts
      window.useMobile = useMobile;
      window.HiddenMenuWrapper = HiddenMenuWrapper;
      window.VibesSwitch = VibesSwitch;
      window.VibesButton = VibesButton;
      window.BackIcon = BackIcon;
      window.LoginIcon = LoginIcon;
      window.RemixIcon = RemixIcon;
      window.InviteIcon = InviteIcon;
      window.SettingsIcon = SettingsIcon;

      // === START useAI ===
      // AI hook for proxied OpenRouter calls with metering
      function useAI() {
        const [loading, setLoading] = React.useState(false);
        const [error, setError] = React.useState(null);

        const callAI = React.useCallback(async (options) => {
          setLoading(true);
          setError(null);

          try {
            // Get auth token from Clerk (sell apps have Clerk)
            let authHeader = {};
            if (typeof window !== 'undefined' && window.Clerk?.session) {
              const token = await window.Clerk.session.getToken();
              if (token) {
                authHeader = { 'Authorization': 'Bearer ' + token };
              }
            }

            const response = await fetch('/api/ai/chat', {
              method: 'POST',
              headers: Object.assign({ 'Content-Type': 'application/json' }, authHeader),
              body: JSON.stringify(Object.assign({
                model: options.model || 'anthropic/claude-sonnet-4',
                messages: options.messages
              }, options))
            });

            // Handle limit exceeded (402 from OpenRouter)
            if (response.status === 402) {
              const err = { code: 'LIMIT_EXCEEDED', message: 'AI usage limit reached for this month.' };
              setError(err);
              throw err;
            }

            // Handle other errors
            if (!response.ok) {
              const errorData = await response.json().catch(function() { return {}; });
              const err = {
                code: 'API_ERROR',
                message: (errorData.error && errorData.error.message) || ('API error: ' + response.status),
                status: response.status
              };
              setError(err);
              throw err;
            }

            return await response.json();

          } catch (err) {
            if (!error) {
              setError({ code: 'NETWORK_ERROR', message: err.message || 'Network error' });
            }
            throw err;
          } finally {
            setLoading(false);
          }
        }, [error]);

        return { callAI: callAI, loading: loading, error: error, clearError: function() { setError(null); } };
      }
      window.useAI = useAI;
      // === END useAI ===
    </script>
    <script type="text/babel" data-type="module">
      import React, { createContext, useContext, useState, useEffect, useRef, useCallback, useMemo, useReducer } from "react";
      import ReactDOMClient from "react-dom/client";
      import { useFireproof } from "use-fireproof";
      // NOTE: Using direct URL because Babel standalone doesn't properly use import maps for bare specifiers
      import {
        ClerkProvider,
        SignedIn,
        SignedOut,
        SignInButton,
        SignUpButton,
        UserButton,
        useUser,
        useAuth,
        PricingTable
      } from "https://esm.sh/@clerk/clerk-react@5?deps=react@18.3.1,react-dom@18.3.1";

      // === Menu Components from window (defined in module script above) ===
      const HiddenMenuWrapper = window.HiddenMenuWrapper;
      const VibesPanel = window.VibesPanel;
      const VibesSwitch = window.VibesSwitch;
      const VibesButton = window.VibesButton;

      // === Configuration (like mixtape pattern) ===
      const CONFIG = {
        clerkPublishableKey: "pk_test_cmFwaWQtbW9sbHktMTEuY2xlcmsuYWNjb3VudHMuZGV2JA",
        appName: "celestial-whispers",
        appTitle: "cronos.computer",
        domain: "cronos.computer",
        billingMode: "required",
        features: ["AI-powered natal chart readings","Real-time transit guidance","Personalized cosmic insights","Chat with the stars"],
        tagline: "Deeply personal natal chart readings powered by AI, with real-time transit guidance that speaks to who you truly are.",
        adminUserIds: []
      };

      // Legacy aliases for backward compatibility
      const CLERK_PUBLISHABLE_KEY = CONFIG.clerkPublishableKey;
      const APP_NAME = CONFIG.appName;
      const APP_DOMAIN = CONFIG.domain;
      const BILLING_MODE = CONFIG.billingMode;
      const FEATURES = CONFIG.features;
      const APP_TAGLINE = CONFIG.tagline;
      const ADMIN_USER_IDS = CONFIG.adminUserIds;

      // === Route Detection ===
      function getRouteInfo() {
        const hostname = window.location.hostname;
        const parts = hostname.split('.');
        const params = new URLSearchParams(window.location.search);
        const testSubdomain = params.get('subdomain');

        // Handle localhost for testing
        if (hostname === 'localhost' || hostname === '127.0.0.1') {
          if (testSubdomain === 'admin') return { route: 'admin', subdomain: null };
          if (testSubdomain) return { route: 'tenant', subdomain: testSubdomain };
          return { route: 'landing', subdomain: null };
        }

        // Handle exe.xyz for testing (before custom domain is set up)
        if (hostname.endsWith('.exe.xyz')) {
          if (testSubdomain === 'admin') return { route: 'admin', subdomain: null };
          if (testSubdomain) return { route: 'tenant', subdomain: testSubdomain };
          return { route: 'landing', subdomain: null };
        }

        // Production: detect subdomain from hostname
        if (parts.length <= 2 || parts[0] === 'www') {
          return { route: 'landing', subdomain: null };
        }
        if (parts[0] === 'admin') {
          return { route: 'admin', subdomain: null };
        }
        return { route: 'tenant', subdomain: parts[0] };
      }

      const routeInfo = getRouteInfo();

      // === Tenant Context ===
      const TenantContext = createContext(null);

      function useTenant() {
        const context = useContext(TenantContext);
        if (!context) throw new Error("useTenant must be used within TenantProvider");
        return context;
      }

      // Make useTenant available globally for the embedded App
      window.useTenant = useTenant;

      function TenantProvider({ children, subdomain }) {
        const dbName = `${APP_NAME}-${subdomain}`;
        return (
          <TenantContext.Provider value={{ subdomain, dbName, appName: APP_NAME, domain: APP_DOMAIN }}>
            {children}
          </TenantContext.Provider>
        );
      }

      // === Subscription Gate ===
      function SubscriptionRequired() {
        const { subdomain } = useTenant();

        return (
          <div className="min-h-screen bg-[var(--vibes-gray-lightest,#f9fafb)] p-4">
            <div className="max-w-4xl mx-auto pt-8">
              {/* Header */}
              <div className="text-center mb-8">
                <h1 className="text-3xl font-bold text-[var(--vibes-black,#111)] mb-2">
                  {CONFIG.appTitle || CONFIG.appName.replace(/-/g, ' ').replace(/\b\w/g, c => c.toUpperCase())}
                </h1>
                <p className="text-lg text-[var(--vibes-black,#111)]/60 mb-2">
                  Subscribe to access <span className="font-semibold">{subdomain}.{APP_DOMAIN}</span>
                </p>
                <p className="text-[var(--vibes-black,#111)]/50">
                  {APP_TAGLINE}
                </p>
              </div>

              {/* Clerk PricingTable */}
              <div className="bg-[var(--vibes-white,#fff)] rounded-2xl border border-[var(--landing-accent)]/20 shadow-lg p-6">
                <PricingTable />
              </div>

              {/* Back to landing link */}
              <div className="text-center mt-6">
                <a
                  href={`https://${APP_DOMAIN}`}
                  className="text-[var(--landing-accent)] hover:underline text-sm"
                >
                  Back to {APP_DOMAIN}
                </a>
              </div>
            </div>
          </div>
        );
      }

      function SubscriptionGate({ children }) {
        const { has, isLoaded, userId } = useAuth();

        if (!isLoaded) {
          return (
            <div className="min-h-screen flex items-center justify-center bg-gray-50">
              <div className="animate-pulse text-lg font-medium text-gray-500">Loading...</div>
            </div>
          );
        }

        // Billing mode "off" = everyone gets free access
        if (BILLING_MODE === 'off') {
          return children;
        }

        // Admins always bypass billing gate
        if (ADMIN_USER_IDS.includes(userId)) {
          return children;
        }

        // Check Clerk Billing subscriptions
        const hasSubscription = has({ plan: 'pro' }) ||
                                has({ plan: 'basic' }) ||
                                has({ plan: 'monthly' }) ||
                                has({ plan: 'yearly' }) ||
                                has({ plan: 'starter' }) ||
                                has({ plan: 'free' });

        if (!hasSubscription) {
          return <SubscriptionRequired />;
        }

        return children;
      }

      // === Tenant Registration (CLIENT-SIDE ONLY - no backend API) ===
      // exe.dev version: Uses only Clerk metadata, no Worker API calls
      function TenantRegistration({ subdomain, children }) {
        const { user, isLoaded } = useUser();
        const [registrationState, setRegistrationState] = useState('checking'); // 'checking' | 'registering' | 'done'

        useEffect(() => {
          if (!isLoaded || !user) return;

          // If user already has a plan in metadata, they're already registered
          if (user.unsafeMetadata?.plan) {
            setRegistrationState('done');
            return;
          }

          // When billing is required, don't auto-set free plan - user must subscribe via Clerk
          if (BILLING_MODE === 'required') {
            // Just record subdomain, no plan - SubscriptionGate will show paywall
            const recordSubdomain = async () => {
              try {
                await user.update({
                  unsafeMetadata: {
                    ...user.unsafeMetadata,
                    subdomain: subdomain,
                    registeredAt: new Date().toISOString()
                  }
                });
              } catch (err) {
                console.error('[TenantRegistration] Failed to record subdomain:', err);
              }
              setRegistrationState('done');
            };
            recordSubdomain();
            return;
          }

          // Billing mode "off" - register via Clerk metadata with free plan
          const register = async () => {
            setRegistrationState('registering');
            try {
              console.log(`[TenantRegistration] Registering ${subdomain} for user ${user.id} (client-side only)`);

              // Update Clerk user metadata with the free plan
              // This is the source of truth for exe.dev deployments
              await user.update({
                unsafeMetadata: {
                  ...user.unsafeMetadata,
                  plan: 'free',
                  subdomain: subdomain,
                  registeredAt: new Date().toISOString()
                }
              });

              console.log(`[TenantRegistration] Success: Clerk metadata updated`);
              setRegistrationState('done');
            } catch (err) {
              console.error('[TenantRegistration] Failed to register tenant:', err);
              setRegistrationState('done'); // Don't block app on registration failure
            }
          };

          register();
        }, [isLoaded, user, subdomain]);

        // Show loading state while registering new users
        if (registrationState === 'checking' || registrationState === 'registering') {
          return (
            <div className="min-h-screen flex items-center justify-center bg-[var(--vibes-gray-lightest)]">
              <div className="text-center">
                <div className="animate-pulse text-lg font-medium text-[var(--vibes-black)]/70 mb-2">
                  Setting up your app...
                </div>
                <p className="text-sm text-[var(--vibes-black)]/50">This will only take a moment</p>
              </div>
            </div>
          );
        }

        return children;
      }

      // === Original App Code (embedded during assembly) ===
      // 
// Zodiac signs data
const ZODIAC_SIGNS = [
  { name: "Aries", symbol: "â™ˆ", element: "Fire", modality: "Cardinal" },
  { name: "Taurus", symbol: "â™‰", element: "Earth", modality: "Fixed" },
  { name: "Gemini", symbol: "â™Š", element: "Air", modality: "Mutable" },
  { name: "Cancer", symbol: "â™‹", element: "Water", modality: "Cardinal" },
  { name: "Leo", symbol: "â™Œ", element: "Fire", modality: "Fixed" },
  { name: "Virgo", symbol: "â™", element: "Earth", modality: "Mutable" },
  { name: "Libra", symbol: "â™Ž", element: "Air", modality: "Cardinal" },
  { name: "Scorpio", symbol: "â™", element: "Water", modality: "Fixed" },
  { name: "Sagittarius", symbol: "â™", element: "Fire", modality: "Mutable" },
  { name: "Capricorn", symbol: "â™‘", element: "Earth", modality: "Cardinal" },
  { name: "Aquarius", symbol: "â™’", element: "Air", modality: "Fixed" },
  { name: "Pisces", symbol: "â™“", element: "Water", modality: "Mutable" }
];

const PLANET_SYMBOLS = {
  Sun: "â˜‰", Moon: "â˜½", Mercury: "â˜¿", Venus: "â™€", Mars: "â™‚",
  Jupiter: "â™ƒ", Saturn: "â™„", Uranus: "â™…", Neptune: "â™†", Pluto: "â™‡",
  NNode: "â˜Š", Chiron: "âš·", Lilith: "âš¸"
};

// Helper to get zodiac sign from degree
function getZodiacSign(degree) {
  const signIndex = Math.floor(degree / 30);
  return ZODIAC_SIGNS[signIndex];
}

function getDegreeInSign(degree) {
  return Math.floor(degree % 30);
}

// Simple city geocoding (common cities)
const CITY_COORDS = {
  "new york": { lat: 40.7128, lng: -74.0060 },
  "los angeles": { lat: 34.0522, lng: -118.2437 },
  "chicago": { lat: 41.8781, lng: -87.6298 },
  "london": { lat: 51.5074, lng: -0.1278 },
  "paris": { lat: 48.8566, lng: 2.3522 },
  "tokyo": { lat: 35.6762, lng: 139.6503 },
  "sydney": { lat: -33.8688, lng: 151.2093 },
  "berlin": { lat: 52.5200, lng: 13.4050 },
  "rome": { lat: 41.9028, lng: 12.4964 },
  "madrid": { lat: 40.4168, lng: -3.7038 },
  "amsterdam": { lat: 52.3676, lng: 4.9041 },
  "toronto": { lat: 43.6532, lng: -79.3832 },
  "san francisco": { lat: 37.7749, lng: -122.4194 },
  "seattle": { lat: 47.6062, lng: -122.3321 },
  "miami": { lat: 25.7617, lng: -80.1918 },
  "boston": { lat: 42.3601, lng: -71.0589 },
  "denver": { lat: 39.7392, lng: -104.9903 },
  "austin": { lat: 30.2672, lng: -97.7431 },
  "portland": { lat: 45.5152, lng: -122.6784 },
  "atlanta": { lat: 33.7490, lng: -84.3880 },
  "mumbai": { lat: 19.0760, lng: 72.8777 },
  "delhi": { lat: 28.7041, lng: 77.1025 },
  "beijing": { lat: 39.9042, lng: 116.4074 },
  "shanghai": { lat: 31.2304, lng: 121.4737 },
  "singapore": { lat: 1.3521, lng: 103.8198 },
  "hong kong": { lat: 22.3193, lng: 114.1694 },
  "dubai": { lat: 25.2048, lng: 55.2708 },
  "cairo": { lat: 30.0444, lng: 31.2357 },
  "cape town": { lat: -33.9249, lng: 18.4241 },
  "moscow": { lat: 55.7558, lng: 37.6173 },
  "sao paulo": { lat: -23.5505, lng: -46.6333 },
  "mexico city": { lat: 19.4326, lng: -99.1332 },
  "buenos aires": { lat: -34.6037, lng: -58.3816 },
  "vancouver": { lat: 49.2827, lng: -123.1207 },
  "montreal": { lat: 45.5017, lng: -73.5673 },
  "barcelona": { lat: 41.3851, lng: 2.1734 },
  "munich": { lat: 48.1351, lng: 11.5820 },
  "vienna": { lat: 48.2082, lng: 16.3738 },
  "prague": { lat: 50.0755, lng: 14.4378 },
  "stockholm": { lat: 59.3293, lng: 18.0686 },
  "copenhagen": { lat: 55.6761, lng: 12.5683 },
  "oslo": { lat: 59.9139, lng: 10.7522 },
  "helsinki": { lat: 60.1699, lng: 24.9384 },
  "dublin": { lat: 53.3498, lng: -6.2603 },
  "lisbon": { lat: 38.7223, lng: -9.1393 },
  "athens, greece": { lat: 37.9838, lng: 23.7275 },
  "athens, ga": { lat: 33.9519, lng: -83.3576 },
  "athens, al": { lat: 34.8045, lng: -86.9717 },
  "athens, alabama": { lat: 34.8045, lng: -86.9717 },
  "athens, georgia": { lat: 33.9519, lng: -83.3576 },
  "athens": { lat: 33.9519, lng: -83.3576 },  // Default to US Athens
  "istanbul": { lat: 41.0082, lng: 28.9784 },
  "tel aviv": { lat: 32.0853, lng: 34.7818 },
  "bangkok": { lat: 13.7563, lng: 100.5018 },
  "seoul": { lat: 37.5665, lng: 126.9780 },
  "taipei": { lat: 25.0330, lng: 121.5654 },
  "manila": { lat: 14.5995, lng: 120.9842 },
  "jakarta": { lat: -6.2088, lng: 106.8456 },
  "auckland": { lat: -36.8509, lng: 174.7645 },
  "melbourne": { lat: -37.8136, lng: 144.9631 },
  "brisbane": { lat: -27.4698, lng: 153.0251 },
  "phoenix": { lat: 33.4484, lng: -112.0740 },
  "philadelphia": { lat: 39.9526, lng: -75.1652 },
  "san diego": { lat: 32.7157, lng: -117.1611 },
  "dallas": { lat: 32.7767, lng: -96.7970 },
  "houston": { lat: 29.7604, lng: -95.3698 },
  "washington": { lat: 38.9072, lng: -77.0369 },
  "nashville": { lat: 36.1627, lng: -86.7816 },
  "new orleans": { lat: 29.9511, lng: -90.0715 },
  "las vegas": { lat: 36.1699, lng: -115.1398 },
  "minneapolis": { lat: 44.9778, lng: -93.2650 },
  "detroit": { lat: 42.3314, lng: -83.0458 },
  "pittsburgh": { lat: 40.4406, lng: -79.9959 },
  "cleveland": { lat: 41.4993, lng: -81.6944 },
  "baltimore": { lat: 39.2904, lng: -76.6122 },
  "charlotte": { lat: 35.2271, lng: -80.8431 },
  "raleigh": { lat: 35.7796, lng: -78.6382 },
  "salt lake city": { lat: 40.7608, lng: -111.8910 },
  "honolulu": { lat: 21.3069, lng: -157.8583 },
  "anchorage": { lat: 61.2181, lng: -149.9003 }
};

function geocodeCity(cityName) {
  const normalized = cityName.toLowerCase().trim();

  // First, try exact match
  if (CITY_COORDS[normalized]) {
    return CITY_COORDS[normalized];
  }

  // Then try to find the most specific match (longer key = more specific)
  let bestMatch = null;
  let bestMatchLength = 0;

  for (const [city, coords] of Object.entries(CITY_COORDS)) {
    if (normalized.includes(city) || city.includes(normalized)) {
      // Prefer longer (more specific) matches
      if (city.length > bestMatchLength) {
        bestMatch = coords;
        bestMatchLength = city.length;
      }
    }
  }

  if (bestMatch) {
    return bestMatch;
  }

  // Default to NYC if not found
  return { lat: 40.7128, lng: -74.0060 };
}

// Calculate Local Sidereal Time from Julian Date and longitude
function calculateLocalSiderealTime(jd, longitude) {
  // Calculate Greenwich Mean Sidereal Time
  const T = (jd - 2451545.0) / 36525;
  let gmst = 280.46061837 + 360.98564736629 * (jd - 2451545.0) +
             0.000387933 * T * T - T * T * T / 38710000;
  gmst = gmst % 360;
  if (gmst < 0) gmst += 360;

  // Convert to Local Sidereal Time
  let lst = gmst + longitude;
  lst = lst % 360;
  if (lst < 0) lst += 360;

  return lst;
}

// Calculate Ascendant using the proper astrological formula
// This finds where the ecliptic crosses the eastern horizon
function calculateAscendantIterative(lst, latitude, obliquity) {
  const toRad = (deg) => deg * Math.PI / 180;
  const toDeg = (rad) => rad * 180 / Math.PI;

  const lstRad = toRad(lst);
  const latRad = toRad(latitude);
  const oblRad = toRad(obliquity);

  // Standard ascendant formula
  // tan(ASC) = cos(ARMC) / -(sin(ARMC) * cos(Îµ) + tan(Ï†) * sin(Îµ))
  const sinLst = Math.sin(lstRad);
  const cosLst = Math.cos(lstRad);
  const sinObl = Math.sin(oblRad);
  const cosObl = Math.cos(oblRad);
  const tanLat = Math.tan(latRad);

  const y = cosLst;
  const x = -(sinLst * cosObl + tanLat * sinObl);

  let asc = toDeg(Math.atan2(y, x));

  // Normalize to 0-360
  if (asc < 0) asc += 360;

  return asc;
}

// Aspect definitions with orbs
const ASPECTS = [
  { name: "Conjunction", symbol: "â˜Œ", angle: 0, orb: 8 },
  { name: "Sextile", symbol: "âš¹", angle: 60, orb: 6 },
  { name: "Square", symbol: "â–¡", angle: 90, orb: 8 },
  { name: "Trine", symbol: "â–³", angle: 120, orb: 8 },
  { name: "Opposition", symbol: "â˜", angle: 180, orb: 8 }
];

// Calculate aspects between planets
function calculateAspects(planets) {
  const aspects = [];
  const planetNames = Object.keys(planets);

  for (let i = 0; i < planetNames.length; i++) {
    for (let j = i + 1; j < planetNames.length; j++) {
      const planet1 = planetNames[i];
      const planet2 = planetNames[j];
      const pos1 = planets[planet1][0];
      const pos2 = planets[planet2][0];

      // Calculate angular separation
      let diff = Math.abs(pos1 - pos2);
      if (diff > 180) diff = 360 - diff;

      // Check each aspect type
      for (const aspect of ASPECTS) {
        const orbDiff = Math.abs(diff - aspect.angle);
        if (orbDiff <= aspect.orb) {
          aspects.push({
            planet1,
            planet2,
            aspect: aspect.name,
            symbol: aspect.symbol,
            angle: aspect.angle,
            orb: orbDiff.toFixed(1)
          });
          break;
        }
      }
    }
  }

  return aspects;
}

// Calculate current transits (aspects between current sky and natal chart)
async function calculateTransits(natalPlanets) {
  try {
    const Astronomy = await import("https://esm.sh/astronomy-engine@2.1.19");
    const now = new Date();
    const observer = new Astronomy.Observer(0, 0, 0); // Position doesn't matter for ecliptic longitude

    const bodies = ['Sun', 'Moon', 'Mercury', 'Venus', 'Mars', 'Jupiter', 'Saturn', 'Uranus', 'Neptune', 'Pluto'];
    const currentPlanets = {};

    // Calculate current positions
    for (const body of bodies) {
      try {
        const equ = Astronomy.Equator(body, now, observer, true, true);
        const ecl = Astronomy.Ecliptic(equ.vec);
        let lon = ecl.elon;
        if (lon < 0) lon += 360;
        currentPlanets[body] = lon;
      } catch (e) {
        console.log(`Could not calculate current ${body}:`, e);
      }
    }

    // Find transits (aspects between current and natal positions)
    const transits = [];
    const transitAspects = [
      { name: "conjunct", angle: 0, orb: 3, symbol: "â˜Œ" },
      { name: "sextile", angle: 60, orb: 2, symbol: "âš¹" },
      { name: "square", angle: 90, orb: 3, symbol: "â–¡" },
      { name: "trine", angle: 120, orb: 3, symbol: "â–³" },
      { name: "opposite", angle: 180, orb: 3, symbol: "â˜" }
    ];

    // Only check outer planet transits to natal positions (most significant)
    const transitingPlanets = ['Jupiter', 'Saturn', 'Uranus', 'Neptune', 'Pluto'];
    const natalBodies = ['Sun', 'Moon', 'Mercury', 'Venus', 'Mars', 'Jupiter', 'Saturn'];

    for (const transiting of transitingPlanets) {
      if (!currentPlanets[transiting]) continue;
      const transitPos = currentPlanets[transiting];
      const transitSign = ZODIAC_SIGNS[Math.floor(transitPos / 30)].name;
      const transitDeg = Math.floor(transitPos % 30);

      for (const natal of natalBodies) {
        const natalData = natalPlanets[natal];
        if (!natalData) continue;
        const natalPos = Array.isArray(natalData) ? natalData[0] : natalData;

        let diff = Math.abs(transitPos - natalPos);
        if (diff > 180) diff = 360 - diff;

        for (const aspect of transitAspects) {
          const orbDiff = Math.abs(diff - aspect.angle);
          if (orbDiff <= aspect.orb) {
            const natalSign = ZODIAC_SIGNS[Math.floor(natalPos / 30)].name;
            transits.push({
              transiting,
              transitSign,
              transitDeg,
              aspect: aspect.name,
              symbol: aspect.symbol,
              natal,
              natalSign,
              orb: orbDiff.toFixed(1)
            });
            break;
          }
        }
      }
    }

    // Also note which houses transiting planets are in (based on natal chart)
    // Current positions through the zodiac
    const currentPositionsSummary = Object.entries(currentPlanets)
      .map(([planet, deg]) => {
        const sign = ZODIAC_SIGNS[Math.floor(deg / 30)].name;
        const degInSign = Math.floor(deg % 30);
        return `${planet}: ${degInSign}Â° ${sign}`;
      })
      .join('\n');

    return { transits, currentPositions: currentPositionsSummary, currentPlanets };
  } catch (err) {
    console.error("Transit calculation error:", err);
    return { transits: [], currentPositions: "", currentPlanets: {} };
  }
}

// Chart visualization component with aspect lines and collision avoidance
function NatalChartSVG({ chartData }) {
  const size = 600;
  const center = size / 2;
  const signRadius = 270;      // Zodiac signs - outermost
  const outerRadius = 230;     // Outer circle
  const planetRadius = 195;    // Planet positions
  const innerRadius = 160;     // Inner circle - aspect lines touch here

  if (!chartData || !chartData.planets) {
    return null;
  }

  const planets = chartData.planets;
  const cusps = chartData.cusps || [];

  // Calculate planet positions with collision avoidance
  const planetEntries = Object.entries(planets).map(([name, data]) => {
    const degree = Array.isArray(data) ? data[0] : data;
    return { name, degree };
  });

  // Sort by degree for collision detection
  planetEntries.sort((a, b) => a.degree - b.degree);

  // Collision avoidance: nudge planets that are too close
  const minAngleDiff = 12; // Minimum degrees apart
  const adjustedPositions = [];

  for (let i = 0; i < planetEntries.length; i++) {
    let adjustedDegree = planetEntries[i].degree;

    // Check against already placed planets
    for (let j = 0; j < adjustedPositions.length; j++) {
      let diff = Math.abs(adjustedDegree - adjustedPositions[j].adjustedDegree);
      if (diff > 180) diff = 360 - diff;

      if (diff < minAngleDiff) {
        // Nudge outward from the cluster
        adjustedDegree = (adjustedPositions[j].adjustedDegree + minAngleDiff) % 360;
      }
    }

    adjustedPositions.push({
      ...planetEntries[i],
      adjustedDegree,
      symbol: PLANET_SYMBOLS[planetEntries[i].name] || planetEntries[i].name[0]
    });
  }

  // Aspect colors
  const aspectColors = {
    "Conjunction": "oklch(55% 0.18 320)", // Purple
    "Sextile": "oklch(55% 0.15 230)",     // Blue
    "Square": "oklch(60% 0.20 25)",       // Red-orange
    "Trine": "oklch(50% 0.15 160)",       // Teal
    "Opposition": "oklch(55% 0.22 15)"    // Red
  };

  // Calculate aspects for drawing
  const aspects = [];
  for (let i = 0; i < adjustedPositions.length; i++) {
    for (let j = i + 1; j < adjustedPositions.length; j++) {
      const p1 = adjustedPositions[i];
      const p2 = adjustedPositions[j];

      let diff = Math.abs(p1.degree - p2.degree);
      if (diff > 180) diff = 360 - diff;

      // Check each aspect type
      for (const aspect of ASPECTS) {
        const orbDiff = Math.abs(diff - aspect.angle);
        if (orbDiff <= aspect.orb) {
          aspects.push({
            p1: p1.degree,
            p2: p2.degree,
            type: aspect.name,
            color: aspectColors[aspect.name]
          });
          break;
        }
      }
    }
  }

  return (
    <svg viewBox={`0 0 ${size} ${size}`} className="w-full max-w-[600px] mx-auto">
      {/* Background for inner circle */}
      <circle
        cx={center}
        cy={center}
        r={innerRadius}
        fill="oklch(99% 0.089 282)"
      />

      {/* Aspect lines - connect to inner circle edge */}
      {aspects.map((aspect, idx) => {
        const angle1 = (aspect.p1 - 90) * (Math.PI / 180);
        const angle2 = (aspect.p2 - 90) * (Math.PI / 180);
        // Lines touch the inner circle edge
        const x1 = center + innerRadius * Math.cos(angle1);
        const y1 = center + innerRadius * Math.sin(angle1);
        const x2 = center + innerRadius * Math.cos(angle2);
        const y2 = center + innerRadius * Math.sin(angle2);

        return (
          <line
            key={`aspect-${idx}`}
            x1={x1}
            y1={y1}
            x2={x2}
            y2={y2}
            stroke={aspect.color}
            strokeWidth="1.5"
            opacity="0.7"
          />
        );
      })}

      {/* Outer circle */}
      <circle
        cx={center}
        cy={center}
        r={outerRadius}
        fill="none"
        stroke="oklch(47% 0.118 222)"
        strokeWidth="2"
      />

      {/* Inner circle */}
      <circle
        cx={center}
        cy={center}
        r={innerRadius}
        fill="none"
        stroke="oklch(67% 0.164 252)"
        strokeWidth="1.5"
      />

      {/* Zodiac divisions */}
      {[...Array(12)].map((_, i) => {
        const angle = (i * 30 - 90) * (Math.PI / 180);
        const x1 = center + innerRadius * Math.cos(angle);
        const y1 = center + innerRadius * Math.sin(angle);
        const x2 = center + outerRadius * Math.cos(angle);
        const y2 = center + outerRadius * Math.sin(angle);
        return (
          <line
            key={`div-${i}`}
            x1={x1}
            y1={y1}
            x2={x2}
            y2={y2}
            stroke="oklch(82% 0.125 242)"
            strokeWidth="1"
          />
        );
      })}

      {/* Zodiac symbols - outside the outer circle */}
      {ZODIAC_SIGNS.map((sign, i) => {
        const angle = ((i * 30 + 15) - 90) * (Math.PI / 180);
        const x = center + signRadius * Math.cos(angle);
        const y = center + signRadius * Math.sin(angle);
        return (
          <text
            key={`sign-${i}`}
            x={x}
            y={y}
            textAnchor="middle"
            dominantBaseline="middle"
            fill="oklch(47% 0.118 222)"
            fontSize="24"
            fontFamily="serif"
          >
            {sign.symbol}
          </text>
        );
      })}

      {/* Planet positions - using adjusted positions to avoid overlap */}
      {adjustedPositions.map((planet) => {
        const angle = (planet.adjustedDegree - 90) * (Math.PI / 180);
        const x = center + planetRadius * Math.cos(angle);
        const y = center + planetRadius * Math.sin(angle);

        return (
          <g key={planet.name}>
            <circle
              cx={x}
              cy={y}
              r="18"
              fill="oklch(96% 0.05 267)"
              stroke="oklch(67% 0.164 252)"
              strokeWidth="2"
            />
            <text
              x={x}
              y={y + 1}
              textAnchor="middle"
              dominantBaseline="middle"
              fill="oklch(40% 0.12 222)"
              fontSize="18"
              fontWeight="500"
            >
              {planet.symbol}
            </text>
          </g>
        );
      })}

      {/* Center point */}
      <circle cx={center} cy={center} r="4" fill="oklch(67% 0.164 252)" />
    </svg>
  );
}

// Loading spinner
function Spinner() {
  return (
    <div className="flex items-center justify-center py-8">
      <div className="w-8 h-8 border-2 border-[oklch(82%_0.125_242)] border-t-[oklch(67%_0.164_252)] rounded-full animate-spin" />
    </div>
  );
}

// Editorial-style reading display with markdown parsing
function ReadingDisplay({ content, sunSign, moonSign, risingSign }) {
  // Parse markdown content into styled sections
  const parseContent = (text) => {
    const sections = [];
    const paragraphs = text.split('\n\n');
    let isFirstParagraph = true;
    let pullQuoteExtracted = false;

    paragraphs.forEach((para, idx) => {
      const trimmed = para.trim();
      if (!trimmed) return;

      // Check if it's a header (starts with ** and ends with **)
      const headerMatch = trimmed.match(/^\*\*(.+?)\*\*$/);
      if (headerMatch) {
        sections.push({
          type: 'header',
          content: headerMatch[1],
          key: idx
        });
        isFirstParagraph = true; // Next paragraph gets special treatment
        return;
      }

      // Parse inline markdown
      let parsed = trimmed
        .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.+?)\*/g, '<em>$1</em>')
        .replace(/â€”/g, 'â€”');

      // Extract a pull quote from longer paragraphs (only once)
      if (!pullQuoteExtracted && parsed.length > 300 && idx > 2 && idx < paragraphs.length - 3) {
        // Find a compelling sentence for pull quote
        const sentences = trimmed.split(/(?<=[.!?])\s+/);
        const goodSentence = sentences.find(s =>
          s.length > 40 && s.length < 150 &&
          (s.includes('you') || s.includes('Your'))
        );
        if (goodSentence) {
          sections.push({
            type: 'pullquote',
            content: goodSentence.replace(/\*+/g, ''),
            key: `pq-${idx}`
          });
          pullQuoteExtracted = true;
        }
      }

      sections.push({
        type: isFirstParagraph ? 'lead' : 'body',
        content: parsed,
        key: idx
      });
      isFirstParagraph = false;
    });

    return sections;
  };

  const sections = parseContent(content);

  return (
    <article className="relative">
      {/* Decorative top element */}
      <div className="flex justify-center mb-12">
        <div className="flex items-center gap-4">
          <div className="w-16 h-px bg-[oklch(67%_0.164_252)]" />
          <span className="text-[oklch(67%_0.164_252)] text-2xl">âœ§</span>
          <div className="w-16 h-px bg-[oklch(67%_0.164_252)]" />
        </div>
      </div>

      {/* Sign badges */}
      <div className="flex justify-center gap-6 mb-16 flex-wrap">
        <div className="text-center">
          <div className="text-xs tracking-[0.2em] uppercase text-[oklch(57%_0.133_232)] mb-1">Sun</div>
          <div className="text-lg font-medium text-[oklch(47%_0.118_222)]">{sunSign}</div>
        </div>
        <div className="w-px h-10 bg-[oklch(82%_0.125_242)]" />
        <div className="text-center">
          <div className="text-xs tracking-[0.2em] uppercase text-[oklch(57%_0.133_232)] mb-1">Moon</div>
          <div className="text-lg font-medium text-[oklch(47%_0.118_222)]">{moonSign}</div>
        </div>
        <div className="w-px h-10 bg-[oklch(82%_0.125_242)]" />
        <div className="text-center">
          <div className="text-xs tracking-[0.2em] uppercase text-[oklch(57%_0.133_232)] mb-1">Rising</div>
          <div className="text-lg font-medium text-[oklch(47%_0.118_222)]">{risingSign}</div>
        </div>
      </div>

      {/* Content */}
      <div className="space-y-8">
        {sections.map((section) => {
          if (section.type === 'header') {
            return (
              <h3
                key={section.key}
                className="text-xl md:text-2xl font-normal text-[oklch(47%_0.118_222)] mt-16 mb-6 tracking-tight"
                style={{ fontVariationSettings: "'opsz' 32" }}
              >
                {section.content}
              </h3>
            );
          }

          if (section.type === 'pullquote') {
            return (
              <blockquote
                key={section.key}
                className="relative my-16 py-8 px-6 md:px-12 md:-mx-8"
              >
                <div className="absolute left-0 top-0 bottom-0 w-1 bg-gradient-to-b from-[oklch(67%_0.164_252)] to-[oklch(82%_0.125_242)]" />
                <p
                  className="text-xl md:text-2xl font-light text-[oklch(47%_0.118_222)] leading-relaxed italic"
                  style={{ fontVariationSettings: "'opsz' 28" }}
                >
                  "{section.content}"
                </p>
              </blockquote>
            );
          }

          if (section.type === 'lead') {
            return (
              <p
                key={section.key}
                className="text-lg md:text-xl text-[oklch(47%_0.118_222)] leading-[1.8] first-letter:text-5xl first-letter:font-semibold first-letter:float-left first-letter:mr-3 first-letter:mt-1 first-letter:text-[oklch(67%_0.164_252)]"
                style={{ fontVariationSettings: "'opsz' 18" }}
                dangerouslySetInnerHTML={{ __html: section.content }}
              />
            );
          }

          // Body paragraphs
          return (
            <p
              key={section.key}
              className="text-base md:text-lg text-[oklch(47%_0.118_222)] leading-[1.9]"
              style={{ fontVariationSettings: "'opsz' 14" }}
              dangerouslySetInnerHTML={{ __html: section.content }}
            />
          );
        })}
      </div>

      {/* Decorative bottom element */}
      <div className="flex justify-center mt-16">
        <div className="flex items-center gap-3">
          <span className="text-[oklch(82%_0.125_242)] text-lg">âœ¦</span>
          <span className="text-[oklch(67%_0.164_252)] text-2xl">âœ§</span>
          <span className="text-[oklch(82%_0.125_242)] text-lg">âœ¦</span>
        </div>
      </div>
    </article>
  );
}

function App() {
  // Multi-tenant database scoping
  const { dbName } = typeof useTenant !== 'undefined' ? useTenant() : { dbName: "astrology-chat-db" };
  const { database, useLiveQuery, useDocument } = useFireproof(dbName);
  const { callAI, loading: aiLoading } = useAI();

  // Check for existing user profile
  const { docs: profiles } = useLiveQuery("type", { key: "profile" });
  const existingProfile = profiles[0];

  // Chat messages
  const { docs: messages } = useLiveQuery("type", { key: "message" });
  const sortedMessages = [...messages].sort((a, b) => (a.createdAt || 0) - (b.createdAt || 0));

  // App state
  const [step, setStep] = useState(existingProfile ? "chart" : "welcome");
  const [chartData, setChartData] = useState(null);
  const [horoscopeData, setHoroscopeData] = useState(null);
  const [generating, setGenerating] = useState(false);

  // Form state for onboarding
  const { doc: formData, merge: updateForm } = useDocument({
    type: "form",
    birthMonth: "",
    birthDay: "",
    birthYear: "",
    birthHour: "",
    birthMinute: "",
    birthCity: "",
    timeUncertain: false
  });

  // Chat input
  const [chatInput, setChatInput] = useState("");
  const chatEndRef = useRef(null);

  // Scroll to bottom of chat
  useEffect(() => {
    if (chatEndRef.current) {
      chatEndRef.current.scrollIntoView({ behavior: "smooth" });
    }
  }, [messages]);

  // Load chart if profile exists
  useEffect(() => {
    if (existingProfile && !chartData) {
      generateChart(existingProfile);
    }
  }, [existingProfile]);

  async function generateChart(profile) {
    setGenerating(true);

    try {
      // Use astronomy-engine for precise planetary calculations
      const Astronomy = await import("https://esm.sh/astronomy-engine@2.1.19");

      // Get timezone offset for birth location using longitude approximation
      // Each 15Â° of longitude = 1 hour offset from UTC
      // This is approximate - proper solution would use a timezone database
      const longitudeOffset = Math.round(profile.longitude / 15);

      // Create UTC date from local birth time
      // We need to convert local birth time at birth location to UTC
      // Handle hour carefully - 0 is valid (midnight), don't default to 12
      const localHour = profile.birthHour !== "" ? parseInt(profile.birthHour) : 12;
      const localMinute = profile.birthMinute !== "" ? parseInt(profile.birthMinute) : 0;

      // For US locations in summer, we also need to account for DST
      // This is a simplification - assumes DST for summer months in US
      const month = parseInt(profile.birthMonth);
      const isDST = profile.longitude < -50 && profile.longitude > -130 &&
                    (month >= 4 && month <= 10); // Rough DST estimate for US
      const dstOffset = isDST ? 1 : 0;

      // Calculate UTC hour
      const utcHour = localHour - longitudeOffset - dstOffset;

      // Create date in UTC
      const birthDate = new Date(Date.UTC(
        parseInt(profile.birthYear),
        parseInt(profile.birthMonth) - 1,
        parseInt(profile.birthDay),
        utcHour,
        localMinute
      ));

      // Observer location
      const observer = new Astronomy.Observer(profile.latitude, profile.longitude, 0);

      // Calculate planetary positions
      const bodies = ['Sun', 'Moon', 'Mercury', 'Venus', 'Mars', 'Jupiter', 'Saturn', 'Uranus', 'Neptune', 'Pluto'];
      const planets = {};

      for (const body of bodies) {
        try {
          const equ = Astronomy.Equator(body, birthDate, observer, true, true);
          const ecl = Astronomy.Ecliptic(equ.vec);
          // Convert to 0-360 degree range
          let lon = ecl.elon;
          if (lon < 0) lon += 360;
          planets[body] = [lon];
        } catch (e) {
          console.log(`Could not calculate ${body}:`, e);
        }
      }

      // Calculate Ascendant using astronomy-engine's horizon functions
      const time = Astronomy.MakeTime(birthDate);

      // Get the obliquity at this specific time
      const obliquity = 23.4393 - 0.013 * ((time.ut - 2451545.0) / 36525);

      // Calculate Local Sidereal Time properly
      // astronomy-engine gives us Julian UT1 date
      const jd = time.ut;

      // Use astronomy-engine's sidereal time function if available
      let lst;
      if (Astronomy.SiderealTime) {
        // Get Greenwich Sidereal Time in hours, convert to degrees
        const gst = Astronomy.SiderealTime(time);
        lst = (gst * 15 + profile.longitude) % 360;
        if (lst < 0) lst += 360;
      } else {
        lst = calculateLocalSiderealTime(jd, profile.longitude);
      }

      // DEBUG: Log the values
      console.log("=== CHART DEBUG ===");
      console.log("Birth Date (UTC):", birthDate.toISOString());
      console.log("Julian Date:", jd);
      console.log("Local Sidereal Time (degrees):", lst);
      console.log("LST (hours):", lst / 15);
      console.log("Latitude:", profile.latitude);
      console.log("Longitude:", profile.longitude);
      console.log("Obliquity:", obliquity);

      // Calculate ascendant - the ecliptic longitude at eastern horizon
      let ascendant = calculateAscendantIterative(lst, profile.latitude, obliquity);

      console.log("Calculated Ascendant (degrees):", ascendant);
      console.log("Ascendant Sign:", ZODIAC_SIGNS[Math.floor(ascendant / 30)].name);
      console.log("===================");

      // Generate house cusps using equal house system (Ascendant-based)
      const cusps = [];
      for (let i = 0; i < 12; i++) {
        cusps.push((ascendant + i * 30) % 360);
      }

      // Calculate aspects between planets
      const aspects = calculateAspects(planets);

      // Store calculated data for AI reading
      const horoscopeData = {
        planets,
        cusps,
        ascendant,
        aspects,
        CelestialBodies: Object.fromEntries(
          Object.entries(planets).map(([name, [deg]]) => [
            name.toLowerCase(),
            {
              Sign: { label: ZODIAC_SIGNS[Math.floor(deg / 30)].name },
              ChartPosition: { Ecliptic: { DecimalDegrees: deg } }
            }
          ])
        ),
        Ascendant: { Sign: { label: ZODIAC_SIGNS[Math.floor(ascendant / 30)].name } }
      };

      setHoroscopeData(horoscopeData);

      setChartData({ planets, cusps });

      // Check if we need to generate a reading
      const { docs: readings } = await database.query("type", { key: "reading" });
      if (readings.length === 0) {
        await generateReading(horoscopeData, profile);
      }

    } catch (err) {
      console.error("Chart generation error:", err);
    }

    setGenerating(false);
  }

  async function generateReading(chartInfo, profile) {
    // Build chart summary for AI
    const celestialBodies = chartInfo.CelestialBodies || {};
    const sunSign = celestialBodies.sun?.Sign?.label || "Unknown";
    const moonSign = celestialBodies.moon?.Sign?.label || "Unknown";
    const risingSign = chartInfo.Ascendant?.Sign?.label || "Unknown";

    const planetPositions = Object.entries(celestialBodies)
      .map(([planet, data]) => {
        const sign = data?.Sign?.label || "Unknown";
        const degree = data?.ChartPosition?.Ecliptic?.DecimalDegrees;
        const degInSign = degree ? Math.floor(degree % 30) : 0;
        return `${planet.charAt(0).toUpperCase() + planet.slice(1)}: ${degInSign}Â° ${sign}`;
      })
      .join("\n");

    // Format aspects for the prompt
    const aspectsList = (chartInfo.aspects || [])
      .map(a => `${a.planet1} ${a.symbol} ${a.planet2} (${a.aspect}, ${a.orb}Â° orb)`)
      .join("\n");

    // Identify element and modality distributions
    const elements = { Fire: [], Earth: [], Air: [], Water: [] };
    const modalities = { Cardinal: [], Fixed: [], Mutable: [] };

    Object.entries(celestialBodies).forEach(([planet, data]) => {
      const sign = data?.Sign?.label;
      const signData = ZODIAC_SIGNS.find(s => s.name === sign);
      if (signData) {
        elements[signData.element].push(planet);
        modalities[signData.modality].push(planet);
      }
    });

    const elementSummary = Object.entries(elements)
      .map(([el, planets]) => `${el}: ${planets.length} (${planets.join(', ') || 'none'})`)
      .join('\n');

    const modalitySummary = Object.entries(modalities)
      .map(([mod, planets]) => `${mod}: ${planets.length} (${planets.join(', ') || 'none'})`)
      .join('\n');

    // Find dominant element and modality
    const dominantElement = Object.entries(elements).sort((a, b) => b[1].length - a[1].length)[0];
    const dominantModality = Object.entries(modalities).sort((a, b) => b[1].length - a[1].length)[0];

    // Identify stelliums (3+ planets in same sign)
    const signCounts = {};
    Object.entries(celestialBodies).forEach(([planet, data]) => {
      const sign = data?.Sign?.label;
      if (sign) {
        signCounts[sign] = signCounts[sign] || [];
        signCounts[sign].push(planet);
      }
    });
    const stelliums = Object.entries(signCounts)
      .filter(([sign, planets]) => planets.length >= 3)
      .map(([sign, planets]) => `${sign} (${planets.join(', ')})`)
      .join('; ');

    const prompt = `You are a veteran astrologer with 30+ years of experience. Your gift is seeing the WHOLE personâ€”not just what each placement means, but how they weave together into a living, breathing human story.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
NATAL CHART DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

THE BIG THREE:
â€¢ Sun: ${sunSign} (${celestialBodies.sun?.ChartPosition?.Ecliptic?.DecimalDegrees?.toFixed(1) || 0}Â°)
â€¢ Moon: ${moonSign} (${celestialBodies.moon?.ChartPosition?.Ecliptic?.DecimalDegrees?.toFixed(1) || 0}Â°)
â€¢ Rising/Ascendant: ${risingSign}

ALL PLANET POSITIONS:
${planetPositions}

ASPECTS (planetary relationships):
${aspectsList || "No major aspects"}

ELEMENT BALANCE:
${elementSummary}
â†’ Dominant: ${dominantElement[0]} (${dominantElement[1].length} planets)

MODALITY BALANCE:
${modalitySummary}
â†’ Dominant: ${dominantModality[0]} (${dominantModality[1].length} planets)

${stelliums ? `STELLIUMS: ${stelliums}` : 'No stelliums (3+ planets in one sign)'}

BIRTH: ${profile.birthCity}, ${profile.birthMonth}/${profile.birthDay}/${profile.birthYear}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
YOUR TASK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Write an 800-1200 word reading that makes this person feel truly SEEN.

FIRST, silently analyze (don't write this part):
- What does the Sun-Moon-Rising combination reveal about core self vs. emotional needs vs. public face?
- What's the chart's overall "flavor" from element/modality dominance?
- What tensions exist in the aspects? What flows easily?
- Where is the ruler of their Sun sign? Their Rising? What layers does this add?
- What's their likely core wound? Their superpower?

THEN, write the reading with this approach:
- Open with what strikes you MOSTâ€”the single most interesting or paradoxical thing about this chart. Hook them immediately.
- Weave placements into a coherent narrative about WHO this person isâ€”not a list of traits
- Name the CENTRAL TENSION they likely feel dailyâ€”the push-pull that defines their inner life
- Identify their "secret"â€”something they might not fully realize about themselves, but will recognize instantly when they read it
- Speak to the EXPERIENCE of being them: "You probably find yourself..." / "There's a part of you that..."
- Find unexpected connections: How does Mars illuminate Moon? How does Rising mask or reveal Sun?
- Ask: What question is their soul trying to answer in this lifetime?
- End with something profoundâ€”not advice, but RECOGNITION. Honor the complexity of who they are.

VOICE & STYLE:
- Warm but not soft. You see clearly, including the hard parts.
- CONFIDENT. No "may" or "might" hedgingâ€”speak with knowing.
- Occasionally poetic, but grounded. Psychology as much as mysticism.
- Flowing prose, NOT headers or bullet points
- Short paragraphs for rhythm
- *Italics* for emphasis, sparingly
- NO generic sign descriptions. Everything specific to THIS chart.

A great reading makes someone feel like you've known them their whole life. Surprise them with how deeply you understand.`;

    try {
      const response = await callAI({
        model: "anthropic/claude-sonnet-4",
        messages: [{ role: "user", content: prompt }],
        max_tokens: 2000
      });

      const reading = response.choices[0].message.content;

      await database.put({
        type: "reading",
        content: reading,
        chartSummary: { sunSign, moonSign, risingSign, aspects: aspectsList },
        createdAt: Date.now()
      });

    } catch (err) {
      console.error("Reading generation error:", err);
    }
  }

  async function handleOnboardingSubmit(e) {
    e.preventDefault();

    const coords = geocodeCity(formData.birthCity);

    const profile = {
      type: "profile",
      birthMonth: formData.birthMonth,
      birthDay: formData.birthDay,
      birthYear: formData.birthYear,
      birthHour: formData.birthHour || "12",
      birthMinute: formData.birthMinute || "0",
      birthCity: formData.birthCity,
      latitude: coords.lat,
      longitude: coords.lng,
      timeUncertain: formData.timeUncertain,
      createdAt: Date.now()
    };

    await database.put(profile);
    setStep("chart");
    generateChart(profile);
  }

  async function handleChatSubmit(e) {
    e.preventDefault();
    if (!chatInput.trim() || aiLoading) return;

    const userMessage = chatInput.trim();
    setChatInput("");

    // Save user message
    await database.put({
      type: "message",
      role: "user",
      content: userMessage,
      createdAt: Date.now()
    });

    // Get reading for context
    const { docs: readings } = await database.query("type", { key: "reading" });
    const reading = readings[0];

    // Calculate current transits
    let transitContext = "";
    if (chartData?.planets) {
      const { transits, currentPositions } = await calculateTransits(chartData.planets);

      if (transits.length > 0) {
        const transitList = transits
          .map(t => `â€¢ Transiting ${t.transiting} (${t.transitDeg}Â° ${t.transitSign}) ${t.aspect} natal ${t.natal} (${t.natalSign}) - ${t.orb}Â° orb`)
          .join('\n');

        transitContext = `
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CURRENT TRANSITS (as of today)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Active transits to natal chart:
${transitList}

Current sky positions:
${currentPositions}

Use these transits to discuss timing, current influences, and what energies are active RIGHT NOW in their life. Transits show the weatherâ€”what external energies they're navigating.`;
      }
    }

    // Build conversation history
    const history = sortedMessages.slice(-10).map(m => ({
      role: m.role,
      content: m.content
    }));

    const systemPrompt = `You are an experienced, intuitive astrologer continuing a private consultation.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
NATAL CHART (birth blueprint)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
${reading?.chartSummary ? `Sun: ${reading.chartSummary.sunSign}
Moon: ${reading.chartSummary.moonSign}
Rising: ${reading.chartSummary.risingSign}

Natal Aspects:
${reading.chartSummary.aspects || "Not recorded"}` : "Chart data not available"}
${transitContext}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CONSULTATION GUIDELINES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Your initial reading covered their core patterns. Now they're asking follow-up questions.

When discussing TIMING or FUTURE:
- Reference active transits and what they're bringing up
- Outer planet transits (Saturn, Uranus, Neptune, Pluto) are major life themes lasting months/years
- Jupiter transits bring expansion and opportunity, lasting about a year per house
- Be specific: "With Saturn currently squaring your natal Moon, you're likely feeling..."

VOICE:
- Reference chart placements naturally when relevant
- Speak with warmth and confident intuition
- Be curious about what they're really asking beneath the surface
- Occasionally be direct or profoundâ€”don't always be soft
- No disclaimers. You see clearly.
- When they ask about the future, use the transit data to give grounded, specific timing insights`;

    try {
      const response = await callAI({
        model: "anthropic/claude-sonnet-4",
        messages: [
          { role: "system", content: systemPrompt },
          ...history,
          { role: "user", content: userMessage }
        ],
        max_tokens: 1000
      });

      const aiResponse = response.choices[0].message.content;

      await database.put({
        type: "message",
        role: "assistant",
        content: aiResponse,
        createdAt: Date.now()
      });

    } catch (err) {
      console.error("Chat error:", err);
    }
  }

  // Get reading
  const { docs: readings } = useLiveQuery("type", { key: "reading" });
  const reading = readings[0];

  return (
    <div className="min-h-screen bg-[oklch(99%_0.089_282)] font-['Fraunces',serif]">
      {/* Welcome / Onboarding */}
      {step === "welcome" && (
        <div className="min-h-screen flex items-center justify-center p-6">
          <div className="max-w-md w-full text-center">
            <h1 className="text-4xl font-light text-[oklch(47%_0.118_222)] mb-4 tracking-tight">
              Let's begin
            </h1>
            <p className="text-[oklch(57%_0.133_232)] text-lg mb-8 leading-relaxed">
              I'll need a few details to draw your chartâ€”your birthday, birth time, and birthplace.
              These form the foundation of who you are.
            </p>
            <button
              onClick={() => setStep("birth-date")}
              className="px-8 py-4 bg-[oklch(67%_0.164_252)] text-white rounded-full text-lg font-medium hover:bg-[oklch(62%_0.164_252)] transition-colors"
            >
              Continue
            </button>
          </div>
        </div>
      )}

      {/* Birth Date */}
      {step === "birth-date" && (
        <div className="min-h-screen flex items-center justify-center p-6">
          <div className="max-w-md w-full">
            <h2 className="text-3xl font-light text-[oklch(47%_0.118_222)] mb-2 text-center">
              When were you born?
            </h2>
            <p className="text-[oklch(57%_0.133_232)] text-center mb-8">
              The exact date mattersâ€”it determines where the planets were.
            </p>

            <div className="space-y-4">
              <div className="grid grid-cols-3 gap-4">
                <div>
                  <label className="block text-sm text-[oklch(57%_0.133_232)] mb-1">Month</label>
                  <select
                    value={formData.birthMonth}
                    onChange={(e) => updateForm({ birthMonth: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-[oklch(82%_0.125_242)] rounded-lg bg-white text-[oklch(47%_0.118_222)] focus:border-[oklch(67%_0.164_252)] focus:outline-none"
                  >
                    <option value="">--</option>
                    {[...Array(12)].map((_, i) => (
                      <option key={i + 1} value={i + 1}>
                        {new Date(2000, i, 1).toLocaleString("default", { month: "long" })}
                      </option>
                    ))}
                  </select>
                </div>
                <div>
                  <label className="block text-sm text-[oklch(57%_0.133_232)] mb-1">Day</label>
                  <select
                    value={formData.birthDay}
                    onChange={(e) => updateForm({ birthDay: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-[oklch(82%_0.125_242)] rounded-lg bg-white text-[oklch(47%_0.118_222)] focus:border-[oklch(67%_0.164_252)] focus:outline-none"
                  >
                    <option value="">--</option>
                    {[...Array(31)].map((_, i) => (
                      <option key={i + 1} value={i + 1}>{i + 1}</option>
                    ))}
                  </select>
                </div>
                <div>
                  <label className="block text-sm text-[oklch(57%_0.133_232)] mb-1">Year</label>
                  <input
                    type="number"
                    placeholder="1990"
                    value={formData.birthYear}
                    onChange={(e) => updateForm({ birthYear: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-[oklch(82%_0.125_242)] rounded-lg bg-white text-[oklch(47%_0.118_222)] focus:border-[oklch(67%_0.164_252)] focus:outline-none"
                  />
                </div>
              </div>

              <button
                onClick={() => setStep("birth-time")}
                disabled={!formData.birthMonth || !formData.birthDay || !formData.birthYear}
                className="w-full mt-6 px-8 py-4 bg-[oklch(67%_0.164_252)] text-white rounded-full text-lg font-medium hover:bg-[oklch(62%_0.164_252)] transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                Continue
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Birth Time */}
      {step === "birth-time" && (
        <div className="min-h-screen flex items-center justify-center p-6">
          <div className="max-w-md w-full">
            <h2 className="text-3xl font-light text-[oklch(47%_0.118_222)] mb-2 text-center">
              What time were you born?
            </h2>
            <p className="text-[oklch(57%_0.133_232)] text-center mb-8">
              Your rising sign changes every two hours. If you're unsure,
              check your birth certificate or ask family.
            </p>

            <div className="space-y-4">
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm text-[oklch(57%_0.133_232)] mb-1">Hour (24h)</label>
                  <select
                    value={formData.birthHour}
                    onChange={(e) => updateForm({ birthHour: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-[oklch(82%_0.125_242)] rounded-lg bg-white text-[oklch(47%_0.118_222)] focus:border-[oklch(67%_0.164_252)] focus:outline-none"
                  >
                    <option value="">--</option>
                    {[...Array(24)].map((_, i) => (
                      <option key={i} value={i}>
                        {i.toString().padStart(2, "0")}:00
                      </option>
                    ))}
                  </select>
                </div>
                <div>
                  <label className="block text-sm text-[oklch(57%_0.133_232)] mb-1">Minute</label>
                  <select
                    value={formData.birthMinute}
                    onChange={(e) => updateForm({ birthMinute: e.target.value })}
                    className="w-full px-4 py-3 border-2 border-[oklch(82%_0.125_242)] rounded-lg bg-white text-[oklch(47%_0.118_222)] focus:border-[oklch(67%_0.164_252)] focus:outline-none"
                  >
                    <option value="">--</option>
                    {[...Array(60)].map((_, m) => (
                      <option key={m} value={m}>{m.toString().padStart(2, "0")}</option>
                    ))}
                  </select>
                </div>
              </div>

              <label className="flex items-center gap-3 py-2 cursor-pointer">
                <input
                  type="checkbox"
                  checked={formData.timeUncertain}
                  onChange={(e) => updateForm({ timeUncertain: e.target.checked })}
                  className="w-5 h-5 rounded border-2 border-[oklch(82%_0.125_242)] accent-[oklch(67%_0.164_252)]"
                />
                <span className="text-[oklch(57%_0.133_232)]">I'm not sure of the exact time</span>
              </label>

              <button
                onClick={() => setStep("birth-place")}
                className="w-full mt-6 px-8 py-4 bg-[oklch(67%_0.164_252)] text-white rounded-full text-lg font-medium hover:bg-[oklch(62%_0.164_252)] transition-colors"
              >
                Continue
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Birth Place */}
      {step === "birth-place" && (
        <div className="min-h-screen flex items-center justify-center p-6">
          <form onSubmit={handleOnboardingSubmit} className="max-w-md w-full">
            <h2 className="text-3xl font-light text-[oklch(47%_0.118_222)] mb-2 text-center">
              Where were you born?
            </h2>
            <p className="text-[oklch(57%_0.133_232)] text-center mb-8">
              The city and countryâ€”this determines your house placements.
            </p>

            <div className="space-y-4">
              <div>
                <label className="block text-sm text-[oklch(57%_0.133_232)] mb-1">City</label>
                <input
                  type="text"
                  placeholder="New York, London, Tokyo..."
                  value={formData.birthCity}
                  onChange={(e) => updateForm({ birthCity: e.target.value })}
                  className="w-full px-4 py-3 border-2 border-[oklch(82%_0.125_242)] rounded-lg bg-white text-[oklch(47%_0.118_222)] focus:border-[oklch(67%_0.164_252)] focus:outline-none"
                />
              </div>

              <button
                type="submit"
                disabled={!formData.birthCity}
                className="w-full mt-6 px-8 py-4 bg-[oklch(67%_0.164_252)] text-white rounded-full text-lg font-medium hover:bg-[oklch(62%_0.164_252)] transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                Generate My Chart
              </button>
            </div>
          </form>
        </div>
      )}

      {/* Chart & Reading View */}
      {step === "chart" && (
        <div className="min-h-screen">
          <div className="max-w-2xl mx-auto px-6 py-12">
            {/* Header */}
            <header className="text-center mb-12">
              <h1 className="text-3xl font-light text-[oklch(47%_0.118_222)] mb-2">
                Your Natal Chart
              </h1>
              {existingProfile && (
                <p className="text-[oklch(57%_0.133_232)]">
                  {existingProfile.birthCity} Â· {existingProfile.birthMonth}/{existingProfile.birthDay}/{existingProfile.birthYear}
                </p>
              )}
            </header>

            {/* Chart */}
            {generating ? (
              <div className="py-12">
                <Spinner />
                <p className="text-center text-[oklch(57%_0.133_232)] mt-4">Drawing your chart...</p>
              </div>
            ) : chartData ? (
              <div className="mb-12">
                <NatalChartSVG chartData={chartData} />
              </div>
            ) : null}

            {/* Reading */}
            {reading ? (
              <div className="mb-16">
                <ReadingDisplay
                  content={reading.content}
                  sunSign={reading.chartSummary?.sunSign || "Unknown"}
                  moonSign={reading.chartSummary?.moonSign || "Unknown"}
                  risingSign={reading.chartSummary?.risingSign || "Unknown"}
                />
              </div>
            ) : generating || aiLoading ? (
              <div className="py-8">
                <Spinner />
                <p className="text-center text-[oklch(57%_0.133_232)] mt-4">Interpreting your chart...</p>
              </div>
            ) : null}

            {/* Transition to Chat */}
            {reading && (
              <div className="border-t border-[oklch(82%_0.125_242)] pt-12">
                <h2 className="text-2xl font-light text-[oklch(47%_0.118_222)] mb-4 text-center">
                  Ask me anything
                </h2>
                <p className="text-[oklch(57%_0.133_232)] text-center mb-8">
                  About relationships, timing, career, emotional patternsâ€”I'm here.
                </p>

                {/* Chat Messages */}
                <div className="space-y-4 mb-6">
                  {sortedMessages.map((msg) => (
                    <div
                      key={msg._id}
                      className={`p-4 rounded-2xl ${
                        msg.role === "user"
                          ? "bg-[oklch(67%_0.164_252)] text-white ml-12"
                          : "bg-[oklch(92%_0.103_267)] text-[oklch(47%_0.118_222)] mr-12"
                      }`}
                    >
                      {msg.content.split("\n").map((line, i) => (
                        <p key={i} className={i > 0 ? "mt-2" : ""}>{line}</p>
                      ))}
                    </div>
                  ))}
                  {aiLoading && (
                    <div className="bg-[oklch(92%_0.103_267)] p-4 rounded-2xl mr-12">
                      <Spinner />
                    </div>
                  )}
                  <div ref={chatEndRef} />
                </div>

                {/* Chat Input */}
                <form onSubmit={handleChatSubmit} className="flex gap-3">
                  <input
                    type="text"
                    value={chatInput}
                    onChange={(e) => setChatInput(e.target.value)}
                    placeholder="What would you like to explore?"
                    className="flex-1 px-4 py-3 border-2 border-[oklch(82%_0.125_242)] rounded-full bg-white text-[oklch(47%_0.118_222)] focus:border-[oklch(67%_0.164_252)] focus:outline-none"
                  />
                  <button
                    type="submit"
                    disabled={aiLoading || !chatInput.trim()}
                    className="px-6 py-3 bg-[oklch(67%_0.164_252)] text-white rounded-full font-medium hover:bg-[oklch(62%_0.164_252)] transition-colors disabled:opacity-50"
                  >
                    Send
                  </button>
                </form>
              </div>
            )}
          </div>
        </div>
      )}

      {/* Google Fonts & Typography Styles */}
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,400;0,9..144,500;0,9..144,600;1,9..144,300;1,9..144,400&display=swap');

        /* Enhanced typography */
        article strong {
          font-weight: 500;
          color: oklch(47% 0.118 222);
        }

        article em {
          font-style: italic;
          font-variation-settings: 'opsz' 14;
        }

        /* Smooth optical sizing transitions */
        article p, article h3, article blockquote {
          font-optical-sizing: auto;
          text-rendering: optimizeLegibility;
          -webkit-font-smoothing: antialiased;
        }

        /* First letter styling enhancement */
        article p.lead::first-letter {
          line-height: 0.8;
        }

        /* Reading container max-width for optimal line length */
        article {
          max-width: 42rem;
          margin-left: auto;
          margin-right: auto;
        }
      `}</style>
    </div>
  );
}

      // === Sign In Screen (for tenant) ===
      function SignInScreen({ subdomain }) {
        return (
          <div className="min-h-screen flex items-center justify-center bg-[var(--vibes-gray-lightest)] p-4">
            <div className="max-w-md text-center p-8 bg-[var(--vibes-white)] rounded-2xl border border-[var(--landing-accent)]/20 shadow-lg">
              <h2 className="text-2xl font-bold text-[var(--vibes-black)] mb-2">Welcome to {subdomain}</h2>
              <p className="mb-6 text-[var(--vibes-black)]/60">Sign in to continue</p>
              <SignInButton mode="modal">
                <button className="w-full px-6 py-3 bg-[var(--landing-accent)] text-white font-medium rounded-xl hover:bg-[var(--landing-accent-hover)] transition-colors">
                  Sign In
                </button>
              </SignInButton>
              <p className="mt-4 text-sm text-[var(--vibes-black)]/60">
                New here?{' '}
                <a href={`https://${APP_DOMAIN}`} className="text-[var(--landing-accent)] hover:underline font-medium">
                  Sign up
                </a>
              </p>
            </div>
          </div>
        );
      }

      // === Tenant App Wrapper ===
      function TenantApp({ subdomain }) {
        return (
          <ClerkProvider publishableKey={CLERK_PUBLISHABLE_KEY} afterSignOutUrl={`https://${APP_DOMAIN}`}>
            <TenantProvider subdomain={subdomain}>
              <SignedIn>
                <TenantRegistration subdomain={subdomain}>
                  <SubscriptionGate>
                    <HiddenMenuWrapper menuContent={<VibesPanel />}>
                      <div className="relative">
                        <div className="fixed top-4 right-4 z-50">
                          <UserButton />
                        </div>
                        <App />
                      </div>
                    </HiddenMenuWrapper>
                  </SubscriptionGate>
                </TenantRegistration>
              </SignedIn>
              <SignedOut>
                <SignInScreen subdomain={subdomain} />
              </SignedOut>
            </TenantProvider>
          </ClerkProvider>
        );
      }

      // === Admin Components (CLIENT-SIDE ONLY - no backend API) ===
      // Admin Dashboard Components (exe.dev - Client-Side Only)
// Injected into unified-exe.html by assemble-sell-exe.js
// Uses CONFIG object and CSS variables for theming
// NOTE: No backend API calls - uses Clerk metadata as source of truth

// === Subscription Badge Component ===
function SubscriptionBadge({ status }) {
  const badges = {
    active: { bg: 'bg-green-500/20', text: 'text-green-600', label: 'Subscribed' },
    trial: { bg: 'bg-yellow-500/20', text: 'text-yellow-600', label: 'Trial' },
    past_due: { bg: 'bg-red-500/20', text: 'text-red-600', label: 'Past Due' },
    canceled: { bg: 'bg-gray-500/20', text: 'text-gray-600', label: 'Canceled' },
  };
  const badge = badges[status] || { bg: 'bg-blue-500/20', text: 'text-blue-600', label: 'Free' };

  return (
    <span className={`px-2 py-1 rounded text-xs font-bold ${badge.bg} ${badge.text}`}>
      {badge.label}
    </span>
  );
}

// === Admin Dashboard (Client-Side Only) ===
function AdminDashboard() {
  const [activeTab, setActiveTab] = useState('overview');
  const { user } = useUser();

  // SECURITY: Do NOT add fallbacks like "|| CONFIG.adminUserIds.length === 0"
  // Empty admin list means NO admin access, not everyone is admin
  const isAdmin = CONFIG.adminUserIds.includes(user?.id);

  if (!isAdmin) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-[var(--admin-bg)] p-4">
        <div className="max-w-md text-center p-8 bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[8px_8px_0px_var(--admin-shadow)]">
          <h2 className="text-2xl font-bold mb-4 text-[var(--admin-text)]">Access Denied</h2>
          <p className="text-[var(--admin-text-muted)] mb-4">You don't have admin permissions.</p>
          <p className="text-sm text-[var(--admin-text-muted)]">Your user ID: {user?.id}</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-[var(--admin-bg)] p-4">
      <div className="max-w-6xl mx-auto">
        <header className="flex justify-between items-center mb-8">
          <h1 className="text-3xl font-bold text-[var(--admin-text)]">{CONFIG.appTitle} Admin</h1>
          <UserButton />
        </header>

        {/* Client-Side Only Notice */}
        <div className="mb-6 p-4 bg-blue-100 border-4 border-blue-500 text-blue-700">
          <p className="font-bold mb-1">Client-Side Admin Dashboard</p>
          <p className="text-sm">
            This admin dashboard runs without a backend server. Tenant data is stored in Clerk user metadata.
            For full analytics, use Clerk's dashboard.
          </p>
        </div>

        {/* Tab Navigation */}
        <div className="flex gap-2 mb-6">
          {['overview', 'config'].map((tab) => (
            <button
              key={tab}
              onClick={() => setActiveTab(tab)}
              className={`px-4 py-2 font-bold border-4 border-[var(--admin-border)] transition-all capitalize ${
                activeTab === tab
                  ? 'bg-[var(--admin-border)] text-[var(--admin-card-bg)] shadow-none'
                  : 'bg-[var(--admin-card-bg)] text-[var(--admin-text)] shadow-[4px_4px_0px_var(--admin-shadow)] hover:shadow-[2px_2px_0px_var(--admin-shadow)] hover:translate-x-[2px] hover:translate-y-[2px]'
              }`}
            >
              {tab}
            </button>
          ))}
        </div>

        {/* Overview Tab */}
        {activeTab === 'overview' && (
          <>
            <div className="grid md:grid-cols-3 gap-6 mb-8">
              <div className="p-6 bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[6px_6px_0px_var(--admin-shadow)]">
                <h3 className="text-sm font-bold text-[var(--admin-text-muted)] mb-2">DEPLOYMENT</h3>
                <p className="text-2xl font-bold text-[var(--admin-text)]">exe.dev</p>
                <p className="text-sm text-[var(--admin-text-muted)] mt-1">Client-side only</p>
              </div>
              <div className="p-6 bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[6px_6px_0px_#3b82f6]">
                <h3 className="text-sm font-bold text-[var(--admin-text-muted)] mb-2">DOMAIN</h3>
                <p className="text-2xl font-bold text-blue-600 break-all">{CONFIG.domain}</p>
              </div>
              <div className="p-6 bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[6px_6px_0px_var(--admin-accent)]">
                <h3 className="text-sm font-bold text-[var(--admin-text-muted)] mb-2">AUTH PROVIDER</h3>
                <p className="text-2xl font-bold text-green-600">Clerk</p>
                <p className="text-sm text-[var(--admin-text-muted)] mt-1">With Billing</p>
              </div>
            </div>

            {/* Quick Links */}
            <div className="grid md:grid-cols-2 gap-6">
              <div className="bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[6px_6px_0px_var(--admin-shadow)] p-6">
                <h3 className="font-bold mb-4 text-[var(--admin-text)]">Manage Users</h3>
                <p className="text-sm text-[var(--admin-text-muted)] mb-4">
                  View and manage all users, subscriptions, and tenant data in the Clerk dashboard.
                </p>
                <a
                  href="https://dashboard.clerk.com"
                  target="_blank"
                  rel="noopener noreferrer"
                  className="inline-block px-4 py-2 bg-[var(--admin-border)] text-[var(--admin-card-bg)] font-bold border-4 border-[var(--admin-border)] hover:opacity-90 transition-opacity"
                >
                  Open Clerk Dashboard â†’
                </a>
              </div>
              <div className="bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[6px_6px_0px_var(--admin-shadow)] p-6">
                <h3 className="font-bold mb-4 text-[var(--admin-text)]">Billing & Revenue</h3>
                <p className="text-sm text-[var(--admin-text-muted)] mb-4">
                  Configure pricing plans and view revenue analytics in Clerk Billing.
                </p>
                <a
                  href="https://dashboard.clerk.com/last-active?path=billing"
                  target="_blank"
                  rel="noopener noreferrer"
                  className="inline-block px-4 py-2 bg-[var(--admin-border)] text-[var(--admin-card-bg)] font-bold border-4 border-[var(--admin-border)] hover:opacity-90 transition-opacity"
                >
                  Open Billing Dashboard â†’
                </a>
              </div>
            </div>

            {/* Your Admin Info */}
            <div className="mt-6 bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[6px_6px_0px_var(--admin-shadow)] p-6">
              <h3 className="font-bold mb-4 text-[var(--admin-text)]">Your Admin Account</h3>
              <div className="flex items-center gap-4">
                {user?.imageUrl && (
                  <img src={user.imageUrl} alt="" className="w-12 h-12 rounded-full border-2 border-[var(--admin-border)]" />
                )}
                <div>
                  <p className="font-bold text-[var(--admin-text)]">{user?.fullName || user?.firstName || 'Admin'}</p>
                  <p className="text-sm text-[var(--admin-text-muted)]">{user?.primaryEmailAddress?.emailAddress}</p>
                  <p className="text-xs text-[var(--admin-text-muted)] font-mono mt-1">{user?.id}</p>
                </div>
              </div>
            </div>
          </>
        )}

        {/* Config Tab */}
        {activeTab === 'config' && (
          <>
            {/* App Configuration */}
            <div className="bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[6px_6px_0px_var(--admin-shadow)] p-6 mb-6">
              <h3 className="font-bold mb-4 text-[var(--admin-text)]">App Configuration</h3>
              <div className="grid md:grid-cols-2 gap-4">
                <div className="p-4 bg-[var(--admin-bg)] border-2 border-[var(--admin-border)]">
                  <p className="text-sm font-bold text-[var(--admin-text-muted)]">App Name</p>
                  <p className="font-mono text-[var(--admin-text)]">{CONFIG.appName}</p>
                </div>
                <div className="p-4 bg-[var(--admin-bg)] border-2 border-[var(--admin-border)]">
                  <p className="text-sm font-bold text-[var(--admin-text-muted)]">App Title</p>
                  <p className="text-[var(--admin-text)]">{CONFIG.appTitle}</p>
                </div>
                <div className="p-4 bg-[var(--admin-bg)] border-2 border-[var(--admin-border)]">
                  <p className="text-sm font-bold text-[var(--admin-text-muted)]">Domain</p>
                  <p className="font-mono text-[var(--admin-text)]">{CONFIG.domain}</p>
                </div>
                <div className="p-4 bg-[var(--admin-bg)] border-2 border-[var(--admin-border)]">
                  <p className="text-sm font-bold text-[var(--admin-text-muted)]">Tagline</p>
                  <p className="text-[var(--admin-text)]">{CONFIG.tagline}</p>
                </div>
              </div>
            </div>

            {/* Billing Configuration */}
            <div className="bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[6px_6px_0px_var(--admin-shadow)] p-6 mb-6">
              <h3 className="font-bold mb-4 text-[var(--admin-text)]">Billing Configuration</h3>
              <div className="p-4 bg-[var(--admin-bg)] border-2 border-[var(--admin-border)]">
                <p className="text-sm font-bold text-[var(--admin-text-muted)]">Billing Mode</p>
                <p className="text-xl font-bold text-[var(--admin-text)] capitalize">{CONFIG.billingMode || 'off'}</p>
                <p className="text-sm text-[var(--admin-text-muted)] mt-2">
                  {CONFIG.billingMode === 'required'
                    ? 'Users must subscribe via Clerk Billing to access the app.'
                    : 'All users have free access after signing in.'}
                </p>
              </div>
              <p className="text-sm text-[var(--admin-text-muted)] mt-4">
                Manage subscription plans in{' '}
                <a
                  href="https://dashboard.clerk.com/last-active?path=billing"
                  target="_blank"
                  rel="noopener noreferrer"
                  className="text-blue-600 hover:underline"
                >
                  Clerk Billing Dashboard
                </a>.
              </p>
            </div>

            {/* Features List */}
            <div className="bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[6px_6px_0px_var(--admin-shadow)] p-6 mb-6">
              <h3 className="font-bold mb-4 text-[var(--admin-text)]">Features ({CONFIG.features.length})</h3>
              <ul className="space-y-2">
                {CONFIG.features.map((feature, i) => (
                  <li key={i} className="flex items-center gap-2 text-[var(--admin-text)]">
                    <svg className="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                    </svg>
                    {feature}
                  </li>
                ))}
              </ul>
            </div>

            {/* Admin Users */}
            <div className="bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[6px_6px_0px_var(--admin-shadow)] p-6">
              <h3 className="font-bold mb-4 text-[var(--admin-text)]">Admin User IDs ({CONFIG.adminUserIds.length})</h3>
              {CONFIG.adminUserIds.length === 0 ? (
                <p className="text-[var(--admin-text-muted)]">No admin users configured. Add user IDs to --admin-ids during assembly.</p>
              ) : (
                <ul className="space-y-2">
                  {CONFIG.adminUserIds.map((id, i) => (
                    <li key={i} className="font-mono text-sm text-[var(--admin-text)] p-2 bg-[var(--admin-bg)] border border-[var(--admin-border)]">
                      {id}
                      {id === user?.id && <span className="ml-2 text-green-600">(you)</span>}
                    </li>
                  ))}
                </ul>
              )}
            </div>
          </>
        )}
      </div>
    </div>
  );
}

// === Admin App Wrapper ===
function AdminApp() {
  return (
    <ClerkProvider publishableKey={CONFIG.clerkPublishableKey} afterSignOutUrl={`https://${CONFIG.domain}`}>
      <SignedIn>
        <AdminDashboard />
      </SignedIn>
      <SignedOut>
        <div className="min-h-screen flex items-center justify-center bg-[var(--admin-bg)] p-4">
          <div className="max-w-md text-center p-8 bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[8px_8px_0px_var(--admin-shadow)]">
            <h2 className="text-2xl font-bold mb-4 text-[var(--admin-text)]">Admin Login</h2>
            <p className="mb-6 text-[var(--admin-text-muted)]">Sign in to access the admin dashboard.</p>
            <SignInButton mode="modal">
              <button className="px-6 py-3 bg-[var(--admin-border)] text-[var(--admin-card-bg)] font-bold border-4 border-[var(--admin-border)] hover:opacity-90 transition-opacity">
                Sign In
              </button>
            </SignInButton>
          </div>
        </div>
      </SignedOut>
    </ClerkProvider>
  );
}

      // === Landing Page Components - cronos.computer Custom Design ===

      // Cookie helpers for returning users
      const LAST_SUBDOMAIN_COOKIE = `${APP_NAME}_last_subdomain`;

      function setLastSubdomainCookie(subdomain) {
        if (subdomain) {
          document.cookie = `${LAST_SUBDOMAIN_COOKIE}=${subdomain}; max-age=31536000; path=/; domain=.${APP_DOMAIN}`;
        }
      }

      function getLastSubdomainCookie() {
        const cookie = document.cookie.split('; ').find(c => c.startsWith(`${LAST_SUBDOMAIN_COOKIE}=`));
        return cookie ? cookie.split('=')[1] : null;
      }

      // Stars component
      function _LandingStars() {
        const stars = Array.from({ length: 50 }, (_, i) => ({
          id: i,
          left: `${Math.random() * 100}%`,
          top: `${Math.random() * 100}%`,
          delay: `${Math.random() * 3}s`,
          duration: `${2 + Math.random() * 2}s`
        }));

        return (
          <div style={{ position: 'absolute', inset: 0 }}>
            {stars.map(star => (
              <div
                key={star.id}
                className="landing-star"
                style={{
                  left: star.left,
                  top: star.top,
                  animationDelay: star.delay,
                  animationDuration: star.duration
                }}
              />
            ))}
          </div>
        );
      }

      // FAQ Item component
      function _FAQItem({ question, answer }) {
        const [isOpen, setIsOpen] = useState(false);
        return (
          <div className={`landing-faq-item ${isOpen ? 'open' : ''}`}>
            <button className="landing-faq-question" onClick={() => setIsOpen(!isOpen)}>
              {question}
              <span style={{ fontSize: '1.5rem', fontWeight: 300, color: 'var(--ana-1)', transition: 'transform 0.3s', transform: isOpen ? 'rotate(45deg)' : 'none' }}>+</span>
            </button>
            <div className="landing-faq-answer">
              <p style={{ color: 'var(--text-secondary)', fontSize: '1rem' }}>{answer}</p>
            </div>
          </div>
        );
      }

      // Main Landing Page
      function _SellLandingPage() {
        const [subdomain, setSubdomain] = useState('');
        const userSubdomain = getLastSubdomainCookie();

        const handleClaim = (e) => {
          e.preventDefault();
          if (subdomain) {
            window.location.href = `https://${subdomain}.${APP_DOMAIN}`;
          }
        };

        const handleGoToApp = () => {
          if (userSubdomain) {
            window.location.href = `https://${userSubdomain}.${APP_DOMAIN}`;
          }
        };

        return (
          <div className="landing-page">
            {/* Navigation */}
            <nav className="landing-nav">
              <div style={{ maxWidth: '1400px', margin: '0 auto', padding: '0 2rem' }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                  <a href="#" className="landing-logo">
                    <span style={{ fontSize: '1.75rem', fontStyle: 'normal' }}>â˜½</span>
                    cronos.computer
                  </a>
                  <div style={{ display: 'flex', gap: '2rem', alignItems: 'center' }}>
                    <a href="#features" style={{ color: 'var(--text-secondary)', textDecoration: 'none', fontSize: '0.9rem', letterSpacing: '0.05em', textTransform: 'uppercase' }}>Features</a>
                    <a href="#how-it-works" style={{ color: 'var(--text-secondary)', textDecoration: 'none', fontSize: '0.9rem', letterSpacing: '0.05em', textTransform: 'uppercase' }}>How It Works</a>
                    <a href="#pricing" style={{ color: 'var(--text-secondary)', textDecoration: 'none', fontSize: '0.9rem', letterSpacing: '0.05em', textTransform: 'uppercase' }}>Pricing</a>
                    {userSubdomain ? (
                      <button onClick={handleGoToApp} className="landing-btn landing-btn-primary">Open App</button>
                    ) : (
                      <a href="#cta" className="landing-btn landing-btn-primary">Get Started</a>
                    )}
                  </div>
                </div>
              </div>
            </nav>

            {/* Hero Section */}
            <section className="landing-hero">
              <div className="landing-hero-gradient" />
              <div className="landing-orb landing-orb-1" />
              <div className="landing-orb landing-orb-2" />
              <div className="landing-orb landing-orb-3" />
              <_LandingStars />

              <div style={{ maxWidth: '1400px', margin: '0 auto', padding: '0 2rem', width: '100%' }}>
                <div style={{ textAlign: 'center', maxWidth: '900px', margin: '0 auto', position: 'relative', zIndex: 1 }}>
                  <p className="landing-eyebrow landing-animate">AI-Powered Astrology</p>
                  <h1 className="landing-animate landing-delay-1" style={{ fontSize: 'clamp(3rem, 8vw, 7rem)', fontWeight: 300, color: 'var(--ana-2)', marginBottom: '2rem' }}>
                    Discover Your<br /><em style={{ fontStyle: 'italic', color: 'var(--ana-1)' }}>Cosmic Blueprint</em>
                  </h1>
                  <p className="landing-animate landing-delay-2" style={{ fontSize: '1.35rem', color: 'var(--text-secondary)', marginBottom: '4rem', fontWeight: 350, maxWidth: '600px', marginLeft: 'auto', marginRight: 'auto' }}>
                    Deeply personal natal chart readings powered by AI, with real-time transit guidance that speaks to who you truly are.
                  </p>

                  <form onSubmit={handleClaim} className="landing-animate landing-delay-3" style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '1rem', marginBottom: '4rem' }}>
                    <div className="subdomain-wrapper">
                      <input
                        type="text"
                        placeholder="yourname"
                        value={subdomain}
                        onChange={(e) => setSubdomain(e.target.value.toLowerCase().replace(/[^a-z0-9-]/g, ''))}
                      />
                      <span className="subdomain-suffix">.{APP_DOMAIN}</span>
                    </div>
                    <button type="submit" className="landing-btn landing-btn-primary landing-btn-large" disabled={!subdomain}>
                      Claim Your Stars <span>â†’</span>
                    </button>
                    <a href="#how-it-works" className="landing-btn landing-btn-secondary landing-btn-large" style={{ marginTop: '1rem' }}>
                      See How It Works
                    </a>
                  </form>

                  <div className="landing-animate landing-delay-4" style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '2rem', color: 'var(--text-muted)', fontSize: '0.9rem' }}>
                    <div style={{ display: 'flex' }}>
                      {['â™ˆ', 'â™Œ', 'â™', 'â™’'].map((sign, i) => (
                        <span key={i} style={{ width: '36px', height: '36px', borderRadius: '50%', background: 'linear-gradient(135deg, var(--ana-4), var(--ana-1))', border: '2px solid var(--bg-primary)', marginRight: '-10px', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '0.75rem' }}>{sign}</span>
                      ))}
                    </div>
                    <span>Join 12,000+ seekers discovering their cosmic path</span>
                  </div>
                </div>
              </div>
            </section>

            {/* Features Section */}
            <section id="features" style={{ padding: '12rem 0', background: 'var(--bg-primary)', position: 'relative' }}>
              <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '1px', background: 'linear-gradient(90deg, transparent, var(--ana-4), transparent)' }} />
              <div style={{ maxWidth: '1400px', margin: '0 auto', padding: '0 2rem' }}>
                <div style={{ textAlign: 'center', marginBottom: '8rem' }}>
                  <h2 style={{ fontSize: 'clamp(2rem, 5vw, 3.5rem)', fontWeight: 350, color: 'var(--ana-2)', marginBottom: '1rem' }}>What Sets Us Apart</h2>
                  <p style={{ color: 'var(--text-secondary)', fontSize: '1.125rem', maxWidth: '65ch', margin: '0 auto' }}>More than horoscopes â€” we reveal the patterns that make you, you.</p>
                </div>

                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '2rem' }}>
                  {[
                    { icon: 'â˜‰', title: 'AI Natal Chart Readings', desc: 'Our AI astrologer analyzes your complete birth chart to deliver readings that feel uncannily personal â€” the kind that makes you wonder "how did they know?"' },
                    { icon: 'â˜½', title: 'Transit-Aware Guidance', desc: 'Real-time planetary movements interpreted through your unique chart. Know exactly when to take action and when to pause.' },
                    { icon: 'âœ¦', title: 'Personalized Cosmic Insights', desc: 'No generic sun sign readings. We weave your Sun, Moon, Rising, and all planetary placements into one cohesive narrative.' },
                    { icon: 'â˜¿', title: 'Chat with the Stars', desc: 'Have a question about love, career, or timing? Our AI astrologer remembers your chart and responds with wisdom tailored to your cosmic DNA.' }
                  ].map((feature, i) => (
                    <div key={i} className="landing-feature-card">
                      <div className="landing-feature-icon">{feature.icon}</div>
                      <h3 style={{ color: 'var(--ana-2)', marginBottom: '0.5rem', fontSize: 'clamp(1.25rem, 2.5vw, 1.75rem)' }}>{feature.title}</h3>
                      <p style={{ color: 'var(--text-secondary)', fontSize: '1rem', maxWidth: '65ch' }}>{feature.desc}</p>
                    </div>
                  ))}
                </div>
              </div>
            </section>

            {/* How It Works */}
            <section id="how-it-works" style={{ padding: '12rem 0', background: 'linear-gradient(180deg, var(--bg-primary) 0%, oklch(96% 0.04 267) 100%)' }}>
              <div style={{ maxWidth: '1400px', margin: '0 auto', padding: '0 2rem' }}>
                <div style={{ textAlign: 'center', marginBottom: '8rem' }}>
                  <h2 style={{ fontSize: 'clamp(2rem, 5vw, 3.5rem)', fontWeight: 350, color: 'var(--ana-2)', marginBottom: '1rem' }}>Your Journey Begins</h2>
                  <p style={{ color: 'var(--text-secondary)', fontSize: '1.125rem' }}>Three simple steps to unlock your celestial story.</p>
                </div>

                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '4rem', position: 'relative' }}>
                  <div style={{ position: 'absolute', top: '60px', left: '15%', right: '15%', height: '2px', background: 'linear-gradient(90deg, var(--ana-5), var(--ana-4), var(--ana-5))' }} />
                  {[
                    { num: '1', title: 'Enter Your Birth Data', desc: 'Date, time, and location â€” the coordinates of your cosmic moment.' },
                    { num: '2', title: 'Receive Your Reading', desc: 'Our AI astrologer crafts your personalized natal interpretation.' },
                    { num: '3', title: 'Explore & Ask', desc: 'Chat about transits, timing, and what the stars have to say.' }
                  ].map((step, i) => (
                    <div key={i} style={{ textAlign: 'center', position: 'relative' }}>
                      <div className="landing-step-number">{step.num}</div>
                      <h3 style={{ color: 'var(--ana-2)', marginBottom: '0.5rem', fontSize: 'clamp(1.25rem, 2.5vw, 1.75rem)' }}>{step.title}</h3>
                      <p style={{ color: 'var(--text-secondary)', fontSize: '1rem', margin: '0 auto', maxWidth: '65ch' }}>{step.desc}</p>
                    </div>
                  ))}
                </div>
              </div>
            </section>

            {/* Testimonials */}
            <section className="landing-dark-section" style={{ padding: '12rem 0' }}>
              <div style={{ maxWidth: '1400px', margin: '0 auto', padding: '0 2rem', position: 'relative', zIndex: 1 }}>
                <div style={{ textAlign: 'center', marginBottom: '8rem' }}>
                  <h2 style={{ fontSize: 'clamp(2rem, 5vw, 3.5rem)', fontWeight: 350, color: 'var(--ana-6)', marginBottom: '1rem' }}>Words from the Stars</h2>
                  <p style={{ color: 'oklch(80% 0.05 252)', fontSize: '1.125rem' }}>What our community is saying about their readings.</p>
                </div>

                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(350px, 1fr))', gap: '2rem' }}>
                  {[
                    { quote: "I've had readings from professional astrologers, but this AI captured something they missed â€” the tension between my Capricorn Moon and Leo Rising. Finally, someone gets me.", name: 'Sarah M.', sign: 'â™Œ', info: 'Leo Sun, Capricorn Moon' },
                    { quote: "The transit feature is incredible. It told me Saturn was squaring my natal Venus â€” and suggested I wait before making relationship decisions. That advice saved me.", name: 'Marcus J.', sign: 'â™', info: 'Scorpio Sun, Pisces Moon' },
                    { quote: "This isn't generic astrology content. The reading identified my 'secret ambition hiding behind a desire to nurture others.' I actually cried. It was that accurate.", name: 'Emma L.', sign: 'â™‹', info: 'Cancer Sun, Aries Moon' }
                  ].map((testimonial, i) => (
                    <div key={i} className="landing-testimonial-card">
                      <div className="landing-testimonial-stars">â˜…â˜…â˜…â˜…â˜…</div>
                      <p style={{ fontSize: '1.125rem', fontStyle: 'italic', lineHeight: 1.8, marginBottom: '2rem', color: 'oklch(90% 0.03 252)' }}>"{testimonial.quote}"</p>
                      <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>
                        <div style={{ width: '48px', height: '48px', borderRadius: '50%', background: 'linear-gradient(135deg, var(--ana-1), var(--ana-3))', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '1.25rem' }}>{testimonial.sign}</div>
                        <div>
                          <strong style={{ display: 'block', color: 'var(--ana-6)' }}>{testimonial.name}</strong>
                          <span style={{ fontSize: '0.9rem', color: 'oklch(60% 0.05 252)' }}>{testimonial.info}</span>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </section>

            {/* Pricing */}
            <section id="pricing" style={{ padding: '12rem 0', background: 'var(--bg-primary)' }}>
              <div style={{ maxWidth: '1000px', margin: '0 auto', padding: '0 2rem' }}>
                <div style={{ textAlign: 'center', marginBottom: '8rem' }}>
                  <h2 style={{ fontSize: 'clamp(2rem, 5vw, 3.5rem)', fontWeight: 350, color: 'var(--ana-2)', marginBottom: '1rem' }}>Choose Your Path</h2>
                  <p style={{ color: 'var(--text-secondary)', fontSize: '1.125rem' }}>Start with a free chart, or unlock the full celestial experience.</p>
                </div>

                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(320px, 1fr))', gap: '2rem' }}>
                  {[
                    { name: 'Stargazer', price: 'Free', note: 'Get started instantly', features: ['Basic natal chart generation', 'Sun, Moon & Rising overview', 'One AI reading', 'Chart visualization'], featured: false, cta: 'Try Free' },
                    { name: 'Cosmic Oracle', price: '$5', period: '/month', note: 'Billed monthly, cancel anytime', features: ['Everything in Stargazer', 'Unlimited AI readings', 'Real-time transit guidance', 'Unlimited chat sessions', 'Detailed aspect analysis', 'Priority support'], featured: true, cta: 'Start Free Trial' },
                    { name: 'Celestial Master', price: '$48', period: '/year', note: 'Save 20% â€” best value', features: ['Everything in Cosmic Oracle', 'Year-ahead transit forecast', 'Synastry (relationship) charts', 'Return chart analysis', 'Early feature access'], featured: false, cta: 'Get Yearly' }
                  ].map((plan, i) => (
                    <div key={i} className={`landing-pricing-card ${plan.featured ? 'featured' : ''}`} style={{ position: 'relative' }}>
                      {plan.featured && <div className="landing-pricing-badge">Most Popular</div>}
                      <h3 style={{ color: 'var(--ana-2)', marginBottom: '0.5rem', fontSize: 'clamp(1.25rem, 2.5vw, 1.75rem)' }}>{plan.name}</h3>
                      <div style={{ fontFamily: "'Fraunces', Georgia, serif", fontSize: '3.5rem', fontWeight: 400, color: 'var(--text-primary)', margin: '1rem 0' }}>
                        {plan.price}<span style={{ fontSize: '1rem', color: 'var(--text-muted)' }}>{plan.period || ''}</span>
                      </div>
                      <p style={{ fontSize: '0.9rem', color: 'var(--text-muted)', marginBottom: '2rem' }}>{plan.note}</p>
                      <ul style={{ listStyle: 'none', textAlign: 'left', marginBottom: '2rem' }}>
                        {plan.features.map((feature, j) => (
                          <li key={j} style={{ padding: '0.75rem 0', borderBottom: '1px solid oklch(90% 0.04 267)', display: 'flex', alignItems: 'center', gap: '0.75rem', color: 'var(--text-secondary)' }}>
                            <span style={{ color: 'var(--ana-1)', fontSize: '0.75rem' }}>âœ¦</span>
                            {feature}
                          </li>
                        ))}
                      </ul>
                      <a href="#cta" className={`landing-btn ${plan.featured ? 'landing-btn-primary' : 'landing-btn-secondary'}`} style={{ width: '100%', justifyContent: 'center' }}>{plan.cta}</a>
                    </div>
                  ))}
                </div>
              </div>
            </section>

            {/* FAQ */}
            <section style={{ padding: '12rem 0', background: 'linear-gradient(180deg, oklch(96% 0.04 267) 0%, var(--bg-primary) 100%)' }}>
              <div style={{ maxWidth: '800px', margin: '0 auto', padding: '0 2rem' }}>
                <div style={{ textAlign: 'center', marginBottom: '8rem' }}>
                  <h2 style={{ fontSize: 'clamp(2rem, 5vw, 3.5rem)', fontWeight: 350, color: 'var(--ana-2)' }}>Questions? We've Got Answers</h2>
                </div>

                <div>
                  <_FAQItem question="How accurate are the AI readings?" answer="Our AI is trained on centuries of astrological wisdom and modern psychological insights. While no reading can be 100% predictive, users consistently report that our interpretations feel deeply personal and insightful â€” often more so than readings from human astrologers." />
                  <_FAQItem question="Do I need to know my exact birth time?" answer="For the most accurate reading, yes. Your birth time determines your Rising sign and house placements. If you don't know it, we can still provide a reading based on your Sun and Moon signs, though it won't be as detailed." />
                  <_FAQItem question="What are transits and why do they matter?" answer="Transits are the current planetary positions relative to your birth chart. They reveal the cosmic weather affecting you right now â€” when to push forward, when to reflect, and what themes are activated in your life. Our transit feature gives you personalized timing guidance." />
                  <_FAQItem question="Can I cancel my subscription anytime?" answer="Absolutely. No contracts, no hidden fees. Cancel with one click and keep access until your billing period ends. We believe our readings speak for themselves." />
                  <_FAQItem question="Is my birth data private?" answer="Completely. Your data is encrypted and stored locally on your device using Fireproof technology. We never sell or share your information with third parties. Your cosmic blueprint is yours alone." />
                </div>
              </div>
            </section>

            {/* CTA Section */}
            <section id="cta" className="landing-dark-section" style={{ padding: '12rem 0', textAlign: 'center' }}>
              <div style={{ position: 'absolute', inset: 0, background: 'radial-gradient(ellipse 80% 50% at 50% 100%, oklch(47% 0.118 222 / 0.4) 0%, transparent 60%)' }} />
              <div style={{ maxWidth: '1400px', margin: '0 auto', padding: '0 2rem', position: 'relative', zIndex: 1 }}>
                <h2 style={{ fontSize: 'clamp(2rem, 5vw, 3.5rem)', fontWeight: 350, color: 'var(--ana-6)', marginBottom: '1rem' }}>Ready to Meet Your Cosmic Self?</h2>
                <p style={{ color: 'oklch(80% 0.05 252)', fontSize: '1.125rem', maxWidth: '65ch', margin: '0 auto 2rem' }}>Your stars are waiting. Claim your personal space in the cosmos.</p>

                <form onSubmit={handleClaim} style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '1rem', marginTop: '2rem' }}>
                  <div className="subdomain-wrapper" style={{ background: 'oklch(20% 0.05 252)', borderColor: 'oklch(40% 0.1 252)' }}>
                    <input
                      type="text"
                      placeholder="yourname"
                      value={subdomain}
                      onChange={(e) => setSubdomain(e.target.value.toLowerCase().replace(/[^a-z0-9-]/g, ''))}
                      style={{ color: '#fff' }}
                    />
                    <span className="subdomain-suffix" style={{ color: 'oklch(70% 0.08 252)' }}>.{APP_DOMAIN}</span>
                  </div>
                  <button type="submit" className="landing-btn landing-btn-primary landing-btn-large" style={{ background: 'var(--ana-1)', color: 'var(--bg-dark)' }} disabled={!subdomain}>
                    Claim Your Stars <span>â†’</span>
                  </button>
                </form>
              </div>
            </section>

            {/* Footer */}
            <footer style={{ padding: '4rem 0', background: 'oklch(10% 0.04 252)', color: 'oklch(60% 0.05 252)' }}>
              <div style={{ maxWidth: '1400px', margin: '0 auto', padding: '0 2rem' }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', flexWrap: 'wrap', gap: '2rem' }}>
                  <span style={{ fontFamily: "'Fraunces', Georgia, serif", fontSize: '1.25rem', fontStyle: 'italic', color: 'var(--ana-4)' }}>â˜½ cronos.computer</span>
                  <div style={{ display: 'flex', gap: '2rem' }}>
                    <a href="#" style={{ color: 'oklch(60% 0.05 252)', textDecoration: 'none', fontSize: '0.9rem' }}>Privacy</a>
                    <a href="#" style={{ color: 'oklch(60% 0.05 252)', textDecoration: 'none', fontSize: '0.9rem' }}>Terms</a>
                    <a href="#" style={{ color: 'oklch(60% 0.05 252)', textDecoration: 'none', fontSize: '0.9rem' }}>Contact</a>
                  </div>
                  <span>Â© 2025 cronos.computer. All rights reserved.</span>
                </div>
              </div>
            </footer>
          </div>
        );
      }

      // === Main Router ===
      function AppRouter() {
        if (routeInfo.route === 'admin') {
          return <AdminApp />;
        }
        if (routeInfo.route === 'tenant') {
          return <TenantApp subdomain={routeInfo.subdomain} />;
        }
        return <_SellLandingPage />;
      }

      // Render
      const rootElement = document.getElementById("container");
      ReactDOMClient.createRoot(rootElement).render(<AppRouter />);
    </script>
  </body>
</html>
